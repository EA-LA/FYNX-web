<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FYNX Finance World - Live News</title>
  <style>
    :root {
      --bg: #f4f7fb;
      --panel: #ffffff;
      --panel-soft: #f8fafc;
      --text: #091120;
      --muted: #607085;
      --line: #dbe4f0;
      --brand: #1767ff;
      --brand-soft: #e8f0ff;
      --pos: #0ea371;
      --neg: #d6375f;
      --warn: #d99700;
      --shadow: 0 16px 42px rgba(11, 37, 84, 0.08);
    }

    body.dark-mode {
      --bg: #070b12;
      --panel: #0f1726;
      --panel-soft: #131d2f;
      --text: #eef4ff;
      --muted: #96a7bf;
      --line: #22314a;
      --brand: #5a90ff;
      --brand-soft: #172746;
      --shadow: 0 16px 42px rgba(0, 0, 0, 0.4);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: "Segoe UI", -apple-system, BlinkMacSystemFont, "Inter", sans-serif;
      background: radial-gradient(circle at 15% 10%, rgba(23, 103, 255, 0.12), transparent 35%), var(--bg);
      color: var(--text);
      min-height: 100vh;
      transition: background 0.25s ease, color 0.25s ease;
    }

    .dashboard-container { display: flex; min-height: 100vh; }

    .nav-panel {
      width: 120px;
      background: var(--panel);
      border-right: 1px solid var(--line);
      display: flex;
      flex-direction: column;
      position: fixed;
      left: 0;
      top: 0;
      height: 100vh;
      z-index: 10;
    }

    .nav-logo {
      padding: 28px 0;
      text-align: center;
      border-bottom: 1px solid var(--line);
      background: linear-gradient(145deg, transparent, rgba(23, 103, 255, 0.06));
    }

    .nav-logo h1 { font-size: 20px; font-weight: 800; letter-spacing: 0.6px; }

    .nav-menu {
      flex: 1;
      padding: 24px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .nav-item {
      width: 80px;
      padding: 14px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 8px;
      border-radius: 10px;
      cursor: pointer;
      color: var(--muted);
      transition: background 0.2s ease, color 0.2s ease;
      text-decoration: none;
    }

    .nav-item:hover,
    .nav-item.active { background: var(--panel-soft); color: var(--text); }

    .nav-icon { width: 20px; height: 20px; stroke: currentColor; stroke-width: 1.7; fill: none; }
    .nav-label { font-size: 11px; font-weight: 600; }

    .main-content {
      margin-left: 120px;
      width: calc(100% - 120px);
      display: flex;
      flex-direction: column;
    }

    .top-bar {
      position: sticky;
      top: 0;
      z-index: 8;
      height: 68px;
      border-bottom: 1px solid var(--line);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 22px;
      background: color-mix(in oklab, var(--panel) 90%, transparent);
      backdrop-filter: blur(8px);
    }

    .page-title { font-size: 16px; font-weight: 700; }

    .top-bar-right { display: flex; align-items: center; gap: 12px; }

    .chip {
      border: 1px solid var(--line);
      background: var(--panel-soft);
      color: var(--muted);
      border-radius: 999px;
      font-size: 12px;
      padding: 8px 12px;
      font-weight: 600;
    }

    .theme-toggle, .notification-icon {
      width: 34px;
      height: 34px;
      border-radius: 8px;
      border: 1px solid var(--line);
      background: var(--panel);
      display: grid;
      place-items: center;
      cursor: pointer;
      color: var(--muted);
    }

    .theme-toggle svg, .notification-icon svg { width: 18px; height: 18px; stroke: currentColor; fill: none; stroke-width: 1.8; }

    .user-avatar {
      width: 34px;
      height: 34px;
      border-radius: 50%;
      background: var(--brand-soft);
      color: var(--brand);
      border: 1px solid color-mix(in oklab, var(--brand) 30%, var(--line));
      display: grid;
      place-items: center;
      font-size: 12px;
      font-weight: 700;
    }

    .content-area {
      padding: 20px;
      display: grid;
      gap: 16px;
    }

    .ticker-wrap {
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 14px;
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    .ticker-label {
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 0.7px;
      text-transform: uppercase;
      color: var(--muted);
      border-bottom: 1px solid var(--line);
      padding: 8px 12px;
      background: var(--panel-soft);
    }

    .ticker {
      display: flex;
      gap: 26px;
      padding: 10px 14px;
      white-space: nowrap;
      overflow-x: auto;
      scrollbar-width: thin;
    }

    .ticker-item { font-size: 13px; font-weight: 700; }
    .ticker-item .p { color: var(--pos); }
    .ticker-item .n { color: var(--neg); }

    .news-layout {
      display: grid;
      grid-template-columns: 320px minmax(0, 1fr);
      gap: 16px;
    }

    .panel {
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 14px;
      box-shadow: var(--shadow);
    }

    .filters {
      padding: 16px;
      display: grid;
      gap: 12px;
      align-content: start;
      position: sticky;
      top: 84px;
      max-height: calc(100vh - 104px);
      overflow: auto;
    }

    .section-title { font-size: 13px; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: 0.7px; }

    .search {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--line);
      background: var(--panel-soft);
      color: var(--text);
      border-radius: 10px;
      font-size: 14px;
      outline: none;
    }

    .btn-row { display: flex; flex-wrap: wrap; gap: 8px; }

    .filter-btn {
      border: 1px solid var(--line);
      background: var(--panel-soft);
      color: var(--muted);
      border-radius: 999px;
      padding: 8px 11px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
    }

    .filter-btn.active {
      background: var(--brand-soft);
      border-color: color-mix(in oklab, var(--brand) 45%, var(--line));
      color: var(--brand);
    }

    .stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .stat {
      background: var(--panel-soft);
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 10px;
    }

    .stat-value { font-size: 18px; font-weight: 800; }
    .stat-label { font-size: 11px; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: 0.6px; }

    .news-panel { padding: 12px; }

    .section-header {
      padding: 8px 8px 16px;
      display: flex;
      align-items: start;
      justify-content: space-between;
      gap: 12px;
      border-bottom: 1px solid var(--line);
      margin-bottom: 10px;
    }

    .section-header h2 { font-size: 26px; line-height: 1.1; }
    .section-header p { color: var(--muted); font-size: 13px; margin-top: 4px; }

    .refresh-btn {
      border: 1px solid var(--line);
      background: var(--panel-soft);
      color: var(--text);
      border-radius: 10px;
      padding: 9px 12px;
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
      white-space: nowrap;
    }

    .news-feed {
      display: grid;
      gap: 10px;
      max-height: calc(100vh - 236px);
      overflow: auto;
      padding-right: 4px;
    }

    .news-card {
      border: 1px solid var(--line);
      border-radius: 12px;
      background: var(--panel-soft);
      padding: 14px;
      transition: transform 0.18s ease, border-color 0.18s ease;
    }

    .news-card:hover { transform: translateY(-1px); border-color: color-mix(in oklab, var(--brand) 35%, var(--line)); }

    .news-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      font-size: 11px;
      margin-bottom: 9px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.6px;
      font-weight: 700;
    }

    .pill {
      border: 1px solid var(--line);
      border-radius: 999px;
      padding: 3px 7px;
      background: var(--panel);
    }

    .pill.sent-pos { color: var(--pos); border-color: color-mix(in oklab, var(--pos) 40%, var(--line)); }
    .pill.sent-neg { color: var(--neg); border-color: color-mix(in oklab, var(--neg) 40%, var(--line)); }
    .pill.sent-neu { color: var(--warn); border-color: color-mix(in oklab, var(--warn) 40%, var(--line)); }

    .news-title {
      font-size: 19px;
      line-height: 1.4;
      margin-bottom: 8px;
      font-weight: 800;
    }

    .news-title a { color: inherit; text-decoration: none; }
    .news-title a:hover { text-decoration: underline; }

    .news-excerpt {
      font-size: 14px;
      color: var(--muted);
      line-height: 1.55;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .status-row {
      margin-top: 8px;
      font-size: 12px;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }

    .skeleton {
      border: 1px solid var(--line);
      border-radius: 10px;
      background: linear-gradient(90deg, var(--panel-soft), color-mix(in oklab, var(--panel-soft) 80%, var(--line)), var(--panel-soft));
      background-size: 200% 100%;
      animation: shimmer 1.4s linear infinite;
      height: 108px;
    }

    @keyframes shimmer { from { background-position: 200% 0; } to { background-position: -200% 0; } }

    .empty {
      border: 1px dashed var(--line);
      border-radius: 12px;
      padding: 22px;
      text-align: center;
      color: var(--muted);
      font-weight: 600;
    }

    @media (max-width: 1080px) {
      .news-layout { grid-template-columns: 1fr; }
      .filters { position: static; max-height: none; }
      .news-feed { max-height: none; }
    }

    @media (max-width: 720px) {
      .nav-panel {
        width: 100%;
        height: auto;
        bottom: 0;
        top: auto;
        border-right: 0;
        border-top: 1px solid var(--line);
        flex-direction: row;
      }

      .nav-logo { display: none; }

      .nav-menu {
        width: 100%;
        flex-direction: row;
        justify-content: space-around;
        padding: 8px;
      }

      .nav-item { width: auto; padding: 8px; }

      .main-content {
        margin-left: 0;
        width: 100%;
        padding-bottom: 88px;
      }

      .top-bar { padding: 0 12px; }
      .section-header h2 { font-size: 23px; }
      .content-area { padding: 12px; }
    }
  </style>
</head>
<body>
  <div class="dashboard-container">
    <nav class="nav-panel">
      <div class="nav-logo"><h1>FYNX</h1></div>
      <div class="nav-menu">
        <a class="nav-item" href="home.html" data-view="home">
          <svg class="nav-icon" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
          <span class="nav-label">Home</span>
        </a>
        <a class="nav-item" href="journal.html" data-view="journal">
          <svg class="nav-icon" viewBox="0 0 24 24"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>
          <span class="nav-label">Journal</span>
        </a>
        <a class="nav-item" href="calculator.html" data-view="calculator">
          <svg class="nav-icon" viewBox="0 0 24 24"><rect x="4" y="2" width="16" height="20" rx="2"></rect><line x1="8" y1="6" x2="16" y2="6"></line><line x1="8" y1="10" x2="16" y2="10"></line><line x1="8" y1="14" x2="16" y2="14"></line><line x1="8" y1="18" x2="16" y2="18"></line></svg>
          <span class="nav-label">Calculator</span>
        </a>
        <a class="nav-item active" href="news.html" data-view="news">
          <svg class="nav-icon" viewBox="0 0 24 24"><path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-2 2zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2"></path><line x1="12" y1="11" x2="18" y2="11"></line><line x1="12" y1="7" x2="18" y2="7"></line></svg>
          <span class="nav-label">News</span>
        </a>
        <a class="nav-item" href="calendar.html" data-view="calendar">
          <svg class="nav-icon" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
          <span class="nav-label">Calendar</span>
        </a>
        <a class="nav-item" href="profile.html" data-view="profile">
          <svg class="nav-icon" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
          <span class="nav-label">Profile</span>
        </a>
      </div>
    </nav>

    <main class="main-content">
      <div class="top-bar">
        <h1 class="page-title">Live Finance News</h1>
        <div class="top-bar-right">
          <span class="chip" id="lastUpdated">Updating...</span>
          <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
            <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.2" y1="4.2" x2="5.7" y2="5.7"></line><line x1="18.3" y1="18.3" x2="19.8" y2="19.8"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.2" y1="19.8" x2="5.7" y2="18.3"></line><line x1="18.3" y1="5.7" x2="19.8" y2="4.2"></line></svg>
          </button>
          <button class="notification-icon" aria-label="Alerts">
            <svg viewBox="0 0 24 24"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
          </button>
          <div class="user-avatar">FX</div>
        </div>
      </div>

      <div class="content-area">
        <section class="ticker-wrap panel">
          <div class="ticker-label">Market Pulse</div>
          <div class="ticker" id="ticker"></div>
        </section>

        <section class="news-layout">
          <aside class="panel filters">
            <div>
              <div class="section-title">Search</div>
              <input id="searchInput" class="search" placeholder="Search topic, source, region..." />
            </div>

            <div>
              <div class="section-title">Region</div>
              <div class="btn-row" id="regionFilters"></div>
            </div>

            <div>
              <div class="section-title">Topic</div>
              <div class="btn-row" id="topicFilters"></div>
            </div>

            <div>
              <div class="section-title">Live Stats</div>
              <div class="stats">
                <div class="stat"><div class="stat-value" id="totalCount">0</div><div class="stat-label">Articles</div></div>
                <div class="stat"><div class="stat-value" id="sourceCount">0</div><div class="stat-label">Sources</div></div>
              </div>
            </div>
          </aside>

          <div class="panel news-panel">
            <div class="section-header">
              <div>
                <h2>Global Finance Wire</h2>
                <p>Real-time market, policy, FX, rates, commodities, and crypto headlines.</p>
              </div>
              <button id="refreshBtn" class="refresh-btn">Refresh now</button>
            </div>

            <div id="newsFeed" class="news-feed"></div>
            <div id="statusText" class="status-row"></div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <script>
    const state = {
      allNews: [],
      filtered: [],
      region: "All",
      topic: "All",
      query: "",
      autoRefreshMs: 120000
    };

    const REGIONS = ["All", "US", "Europe", "Asia", "Middle East", "Africa", "LatAm", "Global"];
    const TOPICS = ["All", "Markets", "Macro", "Equities", "Rates", "FX", "Commodities", "Crypto", "Banking"];

    const FEEDS = [
      { name: "US", topic: "Markets", url: "https://news.google.com/rss/search?q=stock+market+OR+earnings+when:1d&hl=en-US&gl=US&ceid=US:en" },
      { name: "Europe", topic: "Macro", url: "https://news.google.com/rss/search?q=europe+central+bank+OR+euro+zone+inflation+when:1d&hl=en-GB&gl=GB&ceid=GB:en" },
      { name: "Asia", topic: "Markets", url: "https://news.google.com/rss/search?q=nikkei+OR+hang+seng+OR+china+market+when:1d&hl=en-SG&gl=SG&ceid=SG:en" },
      { name: "Middle East", topic: "Commodities", url: "https://news.google.com/rss/search?q=oil+market+OPEC+when:1d&hl=en-AE&gl=AE&ceid=AE:en" },
      { name: "Global", topic: "FX", url: "https://news.google.com/rss/search?q=foreign+exchange+OR+dollar+index+when:1d&hl=en-US&gl=US&ceid=US:en" },
      { name: "Global", topic: "Rates", url: "https://news.google.com/rss/search?q=bond+yields+OR+treasury+when:1d&hl=en-US&gl=US&ceid=US:en" },
      { name: "Global", topic: "Crypto", url: "https://news.google.com/rss/search?q=bitcoin+OR+ethereum+market+when:1d&hl=en-US&gl=US&ceid=US:en" },
      { name: "Global", topic: "Banking", url: "https://news.google.com/rss/search?q=banking+regulation+OR+credit+markets+when:1d&hl=en-US&gl=US&ceid=US:en" }
    ];

    const MARKET_TICKER = [
      { symbol: "S&P 500", value: "+0.41%", positive: true },
      { symbol: "NASDAQ", value: "+0.72%", positive: true },
      { symbol: "DXY", value: "-0.19%", positive: false },
      { symbol: "US10Y", value: "+0.03", positive: true },
      { symbol: "Brent", value: "-0.48%", positive: false },
      { symbol: "Gold", value: "+0.27%", positive: true },
      { symbol: "BTC", value: "+1.12%", positive: true },
      { symbol: "ETH", value: "-0.66%", positive: false }
    ];

    const newsFeed = document.getElementById("newsFeed");
    const statusText = document.getElementById("statusText");
    const lastUpdated = document.getElementById("lastUpdated");
    const searchInput = document.getElementById("searchInput");
    const refreshBtn = document.getElementById("refreshBtn");
    const totalCount = document.getElementById("totalCount");
    const sourceCount = document.getElementById("sourceCount");

    function toggleTheme() {
      document.body.classList.toggle("dark-mode");
      localStorage.setItem("fynxTheme", document.body.classList.contains("dark-mode") ? "dark" : "light");
    }

    function initTheme() {
      const saved = localStorage.getItem("fynxTheme");
      if (saved === "dark") document.body.classList.add("dark-mode");
    }

    function buildTicker() {
      const el = document.getElementById("ticker");
      el.innerHTML = MARKET_TICKER.map(item => `
        <div class="ticker-item">
          ${item.symbol}: <span class="${item.positive ? "p" : "n"}">${item.value}</span>
        </div>`).join("");
    }

    function buildFilterButtons(containerId, values, activeValue, onPick) {
      const el = document.getElementById(containerId);
      el.innerHTML = values
        .map(v => `<button class="filter-btn ${v === activeValue ? "active" : ""}" data-value="${v}">${v}</button>`)
        .join("");
      el.querySelectorAll(".filter-btn").forEach(btn => {
        btn.addEventListener("click", () => onPick(btn.dataset.value));
      });
    }

    function safeText(raw = "") {
      const div = document.createElement("div");
      div.innerHTML = raw;
      return (div.textContent || "").trim();
    }

    function classifyTopic(title = "", desc = "") {
      const text = `${title} ${desc}`.toLowerCase();
      if (/crypto|bitcoin|ethereum|token|blockchain/.test(text)) return "Crypto";
      if (/oil|gas|gold|silver|copper|commodity|opec/.test(text)) return "Commodities";
      if (/forex|currency|dollar|euro|yen|fx/.test(text)) return "FX";
      if (/bond|yield|treasury|rate|fed|ecb|boj|central bank/.test(text)) return "Rates";
      if (/bank|lender|credit|loan|deposit/.test(text)) return "Banking";
      if (/inflation|gdp|jobs|macro|economy|recession/.test(text)) return "Macro";
      if (/stock|equity|shares|ipo|earnings/.test(text)) return "Equities";
      if (/market|index|wall street|exchange/.test(text)) return "Markets";
      return "Markets";
    }

    function classifySentiment(title = "", desc = "") {
      const text = `${title} ${desc}`.toLowerCase();
      const posHits = (text.match(/surge|rally|beat|gain|growth|record|rise|optimis|upgraded|strong/g) || []).length;
      const negHits = (text.match(/drop|fall|miss|weak|risk|downgrade|slump|crisis|cuts|decline/g) || []).length;
      if (posHits > negHits) return "Positive";
      if (negHits > posHits) return "Negative";
      return "Neutral";
    }

    function formatRelativeTime(dateValue) {
      const t = new Date(dateValue).getTime();
      if (!Number.isFinite(t)) return "recent";
      const diff = Date.now() - t;
      const mins = Math.floor(diff / 60000);
      if (mins < 1) return "just now";
      if (mins < 60) return `${mins}m ago`;
      const hrs = Math.floor(mins / 60);
      if (hrs < 24) return `${hrs}h ago`;
      const days = Math.floor(hrs / 24);
      return `${days}d ago`;
    }

    async function fetchXML(url) {
      const viaAllOrigins = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
      const res = await fetch(viaAllOrigins, { cache: "no-store" });
      if (!res.ok) throw new Error(`Feed fetch failed (${res.status})`);
      return res.text();
    }

    async function loadFeed(feed) {
      const xmlText = await fetchXML(feed.url);
      const xml = new DOMParser().parseFromString(xmlText, "application/xml");
      const items = [...xml.querySelectorAll("item")];

      return items.map(item => {
        const title = safeText(item.querySelector("title")?.textContent || "");
        const link = safeText(item.querySelector("link")?.textContent || "");
        const pubDate = safeText(item.querySelector("pubDate")?.textContent || "");
        const desc = safeText(item.querySelector("description")?.textContent || "");
        const sourceTag = safeText(item.querySelector("source")?.textContent || "");

        const source = sourceTag || (title.includes(" - ") ? title.split(" - ").at(-1) : "Unknown Source");
        const cleanTitle = title.replace(/\s+-\s+[^-]+$/, "").trim() || title;
        const topic = classifyTopic(cleanTitle, desc) || feed.topic;
        const sentiment = classifySentiment(cleanTitle, desc);

        return {
          id: `${cleanTitle}|${link}`,
          title: cleanTitle,
          link,
          date: pubDate || new Date().toUTCString(),
          region: feed.name,
          topic,
          source,
          description: desc,
          sentiment
        };
      }).filter(x => x.title && x.link);
    }

    function dedupeAndSort(rows) {
      const map = new Map();
      rows.forEach(row => {
        if (!map.has(row.id)) map.set(row.id, row);
      });
      return [...map.values()].sort((a, b) => new Date(b.date) - new Date(a.date));
    }

    function applyFilters() {
      const query = state.query.trim().toLowerCase();

      state.filtered = state.allNews.filter(item => {
        const regionOk = state.region === "All" || item.region === state.region || item.region === "Global";
        const topicOk = state.topic === "All" || item.topic === state.topic;
        const queryOk = !query || `${item.title} ${item.source} ${item.description}`.toLowerCase().includes(query);
        return regionOk && topicOk && queryOk;
      });

      renderNews();
    }

    function renderNews() {
      totalCount.textContent = state.filtered.length;
      sourceCount.textContent = new Set(state.filtered.map(n => n.source)).size;

      if (!state.filtered.length) {
        newsFeed.innerHTML = `<div class="empty">No articles match this filter. Try changing topic/region.</div>`;
        return;
      }

      newsFeed.innerHTML = state.filtered.map(item => {
        const sentClass = item.sentiment === "Positive" ? "sent-pos" : item.sentiment === "Negative" ? "sent-neg" : "sent-neu";
        return `
          <article class="news-card">
            <div class="news-meta">
              <span class="pill">${item.topic}</span>
              <span class="pill">${item.region}</span>
              <span class="pill">${item.source}</span>
              <span>${formatRelativeTime(item.date)}</span>
              <span class="pill ${sentClass}">${item.sentiment}</span>
            </div>
            <h3 class="news-title"><a href="${item.link}" target="_blank" rel="noopener noreferrer">${item.title}</a></h3>
            <p class="news-excerpt">${item.description || "Open article for full details."}</p>
          </article>`;
      }).join("");
    }

    function renderSkeleton() {
      newsFeed.innerHTML = Array.from({ length: 8 }).map(() => `<div class="skeleton"></div>`).join("");
      statusText.textContent = "Loading live finance feeds...";
    }

    async function refreshNews() {
      renderSkeleton();
      refreshBtn.disabled = true;

      try {
        const settled = await Promise.allSettled(FEEDS.map(loadFeed));
        const succeeded = settled.filter(r => r.status === "fulfilled").map(r => r.value).flat();
        const failed = settled.filter(r => r.status === "rejected").length;

        state.allNews = dedupeAndSort(succeeded).slice(0, 120);
        applyFilters();

        const now = new Date();
        lastUpdated.textContent = `Updated ${now.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" })}`;
        statusText.innerHTML = `<span>Showing ${state.filtered.length} live items.</span><span>${failed ? `${failed} feed(s) failed this run.` : "All feeds healthy."}</span>`;
      } catch (err) {
        newsFeed.innerHTML = `<div class="empty">Could not load live feeds. Try refresh again in a minute.</div>`;
        statusText.textContent = "Feed fetch error.";
      } finally {
        refreshBtn.disabled = false;
      }
    }

    function bindEvents() {
      searchInput.addEventListener("input", (e) => {
        state.query = e.target.value;
        applyFilters();
      });

      refreshBtn.addEventListener("click", refreshNews);

      buildFilterButtons("regionFilters", REGIONS, state.region, (value) => {
        state.region = value;
        buildFilterButtons("regionFilters", REGIONS, state.region, arguments.callee);
        applyFilters();
      });

      buildFilterButtons("topicFilters", TOPICS, state.topic, (value) => {
        state.topic = value;
        buildFilterButtons("topicFilters", TOPICS, state.topic, arguments.callee);
        applyFilters();
      });
    }

    function startAutoRefresh() {
      setInterval(refreshNews, state.autoRefreshMs);
    }

    function init() {
      initTheme();
      buildTicker();
      bindEvents();
      refreshNews();
      startAutoRefresh();
    }

    init();
  </script>
</body>
</html>
