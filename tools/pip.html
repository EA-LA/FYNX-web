<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FYNX Tools — Pip Calculator</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{
      --bg:#000;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.04);
      --border: rgba(255,255,255,.12);
      --border2: rgba(255,255,255,.08);
      --text:#fff;
      --muted: rgba(255,255,255,.68);
      --muted2: rgba(255,255,255,.50);
      --danger:#ff4d4d;
      --shadow: 0 24px 70px rgba(0,0,0,.55);
      --radius: 18px;
      --radius2: 22px;
      --max: 1200px;
    }

    body{
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background: var(--bg);
      overflow-x:hidden;
      min-height:100vh;
    }

    /* Background */
    .animated-bg{
      position:fixed; inset:0; z-index:-1;
      background:#000; overflow:hidden;
    }
    .grid-overlay{
      position:absolute; inset:0;
      background-image:
        linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
      background-size: 52px 52px;
      animation: gridMove 20s linear infinite;
      opacity:.75;
    }
    @keyframes gridMove{
      0%{transform:translate(0,0)}
      100%{transform:translate(52px,52px)}
    }
    .gradient-orb{
      position:absolute; border-radius:999px; filter: blur(80px);
      opacity:.22;
      animation: floaty 18s ease-in-out infinite;
    }
    .orb-1{ width:520px; height:520px; left:-220px; top:-220px; background: radial-gradient(circle, #fff 0%, transparent 65%); }
    .orb-2{ width:520px; height:520px; right:-240px; bottom:-240px; background: radial-gradient(circle, #fff 0%, transparent 65%); animation-delay: 3s;}
    @keyframes floaty{
      0%,100%{transform:translate(0,0) scale(1)}
      50%{transform:translate(30px,-24px) scale(.97)}
    }

    /* Header */
    header{
      position:sticky; top:0; z-index:1000;
      background: rgba(0,0,0,.78);
      backdrop-filter: blur(18px);
      border-bottom: 1px solid var(--border2);
    }
    .nav{
      max-width: var(--max);
      margin: 0 auto;
      padding: 14px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight: 800;
      letter-spacing:.4px;
      user-select:none;
    }
    .brand i{opacity:.92}
    .nav-actions{
      display:flex; align-items:center; gap:10px;
    }
    .btn{
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 14px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.05);
      color: var(--text);
      text-decoration:none;
      font-weight: 650;
      font-size: 14px;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      white-space:nowrap;
    }
    .btn:hover{transform: translateY(-1px); background: rgba(255,255,255,.08); border-color: rgba(255,255,255,.18)}
    .btn i{opacity:.9}

    /* Layout */
    main{
      max-width: var(--max);
      margin: 0 auto;
      padding: 46px 18px 70px;
    }
    .shell{
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border: 1px solid var(--border2);
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      padding: 30px;
    }
    .title{
      font-size: 44px;
      line-height: 1.04;
      font-weight: 900;
      letter-spacing: -1px;
      margin-bottom: 10px;
    }
    .subtitle{
      color: var(--muted);
      font-size: 15px;
      line-height: 1.55;
      max-width: 920px;
      margin-bottom: 22px;
    }
    @media (max-width: 980px){
      .title{font-size: 36px}
    }

    .grid{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap: 16px;
      margin-top: 10px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
    }

    .card{
      border: 1px solid var(--border2);
      background: rgba(0,0,0,.35);
      border-radius: var(--radius);
      padding: 16px;
      min-height: 220px;
    }
    .card h3{
      font-size: 16px;
      font-weight: 900;
      margin-bottom: 10px;
      color: rgba(255,255,255,.92);
      text-transform: uppercase;
      letter-spacing: .6px;
    }
    .hint{
      color: var(--muted2);
      font-size: 13px;
      margin-bottom: 14px;
      line-height: 1.5;
    }

    .row{
      display:grid;
      grid-template-columns: 1.1fr 1fr;
      gap: 10px;
      align-items:center;
      margin-bottom: 10px;
    }
    @media (max-width: 560px){
      .row{grid-template-columns:1fr}
    }
    label{
      color: rgba(255,255,255,.86);
      font-size: 13px;
      font-weight: 850;
    }
    .field{
      width:100%;
      border-radius: 12px;
      border: 1px solid var(--border2);
      background: rgba(255,255,255,.04);
      color: var(--text);
      padding: 10px 12px;
      outline:none;
      font-weight: 800;
    }
    .field:focus{
      border-color: rgba(255,255,255,.22);
      background: rgba(255,255,255,.06);
    }
    .mono{
      font-variant-numeric: tabular-nums;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .actions{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top: 12px;
      justify-content:flex-end;
    }
    .primary{
      border-radius: 14px;
      padding: 12px 14px;
      border: 1px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.14);
      color: #fff;
      font-weight: 950;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      display:inline-flex; align-items:center; gap:10px;
    }
    .primary:hover{transform: translateY(-1px); background: rgba(255,255,255,.18); border-color: rgba(255,255,255,.28)}
    .ghost{
      border-radius: 14px;
      padding: 12px 14px;
      border: 1px solid var(--border2);
      background: rgba(255,255,255,.05);
      color: rgba(255,255,255,.88);
      font-weight: 900;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      display:inline-flex; align-items:center; gap:10px;
    }
    .ghost:hover{transform: translateY(-1px); background: rgba(255,255,255,.08); border-color: rgba(255,255,255,.16)}

    .msg{
      margin-top: 12px;
      color: var(--danger);
      font-weight: 950;
      font-size: 13px;
      min-height: 18px;
    }

    /* Results */
    .resultsBox{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top: 6px;
    }
    .kv{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:12px;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid var(--border2);
      background: rgba(255,255,255,.04);
    }
    .kv .k{
      color: var(--muted2);
      font-size: 12px;
      font-weight: 950;
      letter-spacing:.2px;
      text-transform: uppercase;
    }
    .kv .v{
      font-size: 18px;
      font-weight: 950;
      letter-spacing:-.2px;
    }
    .kv small{
      color: var(--muted2);
      font-size: 12px;
      font-weight: 850;
    }

    .note{
      color: var(--muted2);
      font-size: 12px;
      line-height: 1.55;
      margin-top: 8px;
    }

    /* Share */
    .shareRow{
      display:flex; gap:10px; flex-wrap:wrap; margin-top: 10px;
      align-items:center; justify-content:flex-end;
    }
    .toast{
      position:fixed;
      left:50%; bottom:22px;
      transform:translateX(-50%);
      background: rgba(0,0,0,.78);
      border: 1px solid rgba(255,255,255,.14);
      color: rgba(255,255,255,.9);
      padding: 10px 12px;
      border-radius: 999px;
      backdrop-filter: blur(14px);
      box-shadow: 0 14px 40px rgba(0,0,0,.55);
      display:none;
      z-index:2000;
      font-weight: 900;
      font-size: 13px;
    }
  </style>
</head>

<body>
  <div class="animated-bg">
    <div class="grid-overlay"></div>
    <div class="gradient-orb orb-1"></div>
    <div class="gradient-orb orb-2"></div>
  </div>

  <header>
    <div class="nav">
      <div class="brand"><i class="fa-solid fa-wave-square"></i> FYNX Tools</div>
      <div class="nav-actions">
        <a class="btn" href="javascript:history.back()"><i class="fa-solid fa-arrow-left"></i> Back</a>
        <a class="btn" href="../index.html"><i class="fa-solid fa-house"></i> Home</a>
      </div>
    </div>
  </header>

  <main>
    <div class="shell" id="tapDismiss">
      <div class="title">Pip Calculator</div>
      <div class="subtitle">
        Assumes standard lot = <b>100,000</b> units. Pip size is <b>0.0001</b> for most pairs and <b>0.01</b> for JPY quotes.
        Enter current price and your lot size to calculate <b>$ per pip</b>.
      </div>

      <div class="grid">
        <!-- Inputs -->
        <div class="card">
          <h3>Inputs</h3>
          <div class="hint">
            Current Price examples: <span class="mono">1.0850</span> (non-JPY) or <span class="mono">157.25</span> (JPY).
            Lots examples: <span class="mono">1</span>, <span class="mono">0.1</span>, <span class="mono">0.01</span>.
          </div>

          <div class="row">
            <label for="price">Current Price</label>
            <input id="price" class="field mono" type="text" inputmode="decimal" placeholder="e.g. 1.0850 or 157.25" />
          </div>

          <div class="row">
            <label for="lots">Lots</label>
            <input id="lots" class="field mono" type="text" inputmode="decimal" value="1" placeholder="e.g. 1, 0.1, 0.01" />
          </div>

          <div class="actions">
            <button id="calcBtn" class="primary"><i class="fa-solid fa-calculator"></i> Calculate</button>
            <button id="clearBtn" class="ghost"><i class="fa-solid fa-eraser"></i> Clear</button>
          </div>

          <div class="msg" id="error"></div>
        </div>

        <!-- Results -->
        <div class="card" id="resultsCard">
          <h3>Result</h3>
          <div class="hint" id="emptyHint">Enter values and tap Calculate</div>

          <div class="resultsBox" id="resultsBox" style="display:none;">
            <div class="kv">
              <div>
                <div class="k">Pip size</div>
                <small>0.0001 or 0.01</small>
              </div>
              <div class="v mono" id="pipSizeOut">—</div>
            </div>

            <div class="kv">
              <div>
                <div class="k">Pip value</div>
                <small>per 1.00 lot</small>
              </div>
              <div class="v mono" id="perLotOut">—</div>
            </div>

            <div class="kv">
              <div>
                <div class="k">Pip value</div>
                <small>your lots</small>
              </div>
              <div class="v mono" id="yourOut">—</div>
            </div>

            <div class="note" id="noteOut"></div>

            <div class="shareRow">
              <button id="copyBtn" class="ghost"><i class="fa-solid fa-copy"></i> Copy</button>
              <button id="shareBtn" class="ghost"><i class="fa-solid fa-share-nodes"></i> Share</button>
              <button id="downloadBtn" class="ghost"><i class="fa-solid fa-download"></i> Download PNG</button>
            </div>
          </div>
        </div>
      </div>

      <div class="note" style="margin-top:14px;">
        Logic matches your iOS version: pipSize = (price ≥ 10 ? 0.01 : 0.0001), perLot = 100,000 × pipSize, yourPip = perLot × lots.
      </div>
    </div>
  </main>

  <div class="toast" id="toast">Copied</div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <script>
    const el = {
      price: document.getElementById("price"),
      lots: document.getElementById("lots"),
      calcBtn: document.getElementById("calcBtn"),
      clearBtn: document.getElementById("clearBtn"),
      error: document.getElementById("error"),

      emptyHint: document.getElementById("emptyHint"),
      resultsBox: document.getElementById("resultsBox"),
      resultsCard: document.getElementById("resultsCard"),

      pipSizeOut: document.getElementById("pipSizeOut"),
      perLotOut: document.getElementById("perLotOut"),
      yourOut: document.getElementById("yourOut"),
      noteOut: document.getElementById("noteOut"),

      copyBtn: document.getElementById("copyBtn"),
      shareBtn: document.getElementById("shareBtn"),
      downloadBtn: document.getElementById("downloadBtn"),

      toast: document.getElementById("toast"),
      tapDismiss: document.getElementById("tapDismiss"),
    };

    function clampNumber(str){
      const filtered = String(str ?? "").replace(/[^0-9.\-]/g,"");
      // allow one dot, one leading minus
      let s = filtered;
      const minusCount = (s.match(/\-/g) || []).length;
      if (minusCount > 1) s = s.replace(/\-/g, "");
      if (s.includes("-") && s.indexOf("-") !== 0) s = s.replace(/\-/g,"");
      const parts = s.split(".");
      if (parts.length > 2) s = parts[0] + "." + parts.slice(1).join("");
      return s;
    }

    function parseNum(s){
      const cleaned = String(s ?? "").replaceAll(",", "").replaceAll(" ", "");
      const n = Number(cleaned);
      return Number.isFinite(n) ? n : null;
    }

    function money(x){
      const n = Number(x);
      if (!Number.isFinite(n)) return "—";
      return "$" + n.toFixed(2);
    }

    function setError(msg){
      el.error.textContent = msg || "";
    }

    function showToast(text){
      el.toast.textContent = text || "Done";
      el.toast.style.display = "block";
      clearTimeout(showToast._t);
      showToast._t = setTimeout(() => el.toast.style.display = "none", 1400);
    }

    function resetResults(){
      el.emptyHint.style.display = "block";
      el.resultsBox.style.display = "none";
      el.pipSizeOut.textContent = "—";
      el.perLotOut.textContent = "—";
      el.yourOut.textContent = "—";
      el.noteOut.textContent = "";
    }

    function shareText(){
      const header = "FYNX • Pip Calculator";
      const inputs = `Price: ${el.price.value.trim() || "—"}\nLots: ${el.lots.value.trim() || "—"}`;
      const result = (el.resultsBox.style.display === "none")
        ? "No result yet — tap Calculate."
        : `Pip size: ${el.pipSizeOut.textContent}\nPip value (per 1.00 lot): ${el.perLotOut.textContent}\nPip value (your lots): ${el.yourOut.textContent}`;
      return `${header}\n\n${inputs}\n\nResult:\n${result}\n`;
    }

    function calculate(){
      setError("");
      resetResults();

      const price = parseNum(el.price.value);
      const lots = parseNum(el.lots.value);

      if (!price || price <= 0) { setError("Invalid price"); return; }
      if (!lots || lots <= 0) { setError("Invalid lots"); return; }

      // Same heuristic as your Swift: >= 10 => JPY-style => 0.01 else 0.0001
      const size = price >= 10 ? 0.01 : 0.0001;
      const perLot = 100000.0 * size;
      const yourPip = perLot * lots;

      el.emptyHint.style.display = "none";
      el.resultsBox.style.display = "flex";

      el.pipSizeOut.textContent = (size === 0.01 ? "0.01" : "0.0001");
      el.perLotOut.textContent = money(perLot);
      el.yourOut.textContent = money(yourPip);

      el.noteOut.textContent =
        `Assumption: standard lot = 100,000 units. Pip size chosen by price heuristic (price ≥ 10 ⇒ 0.01).`;
    }

    async function copyResult(){
      const text = shareText();
      try{
        await navigator.clipboard.writeText(text);
        showToast("Copied");
      } catch {
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
        showToast("Copied");
      }
    }

    async function shareResult(){
      const text = shareText();
      if (navigator.share){
        try{
          await navigator.share({ title: "FYNX Pip Calculator", text });
        } catch { /* cancelled */ }
      } else {
        await copyResult();
        showToast("Share not supported — copied");
      }
    }

    async function downloadPNG(){
      try{
        const canvas = await html2canvas(el.resultsCard, {
          backgroundColor: null,
          scale: 2
        });
        const a = document.createElement("a");
        a.download = "fynx-pip-calculator.png";
        a.href = canvas.toDataURL("image/png");
        a.click();
      } catch {
        showToast("Download failed");
      }
    }

    function clearAll(){
      el.price.value = "";
      el.lots.value = "1";
      setError("");
      resetResults();
      el.price.focus();
    }

    // Input filter
    [el.price, el.lots].forEach(inp => {
      inp.addEventListener("input", () => {
        const c = clampNumber(inp.value);
        if (c !== inp.value) inp.value = c;
      });
    });

    // Enter -> calculate
    [el.price, el.lots].forEach(inp => {
      inp.addEventListener("keydown", (e) => {
        if (e.key === "Enter"){
          e.preventDefault();
          calculate();
          document.activeElement.blur();
        }
      });
    });

    // Tap outside inputs to dismiss
    el.tapDismiss.addEventListener("click", (e) => {
      const t = e.target;
      const isInput = t && (t.tagName === "INPUT" || t.tagName === "TEXTAREA");
      if (!isInput){
        document.activeElement && document.activeElement.blur && document.activeElement.blur();
      }
    });

    // Buttons
    el.calcBtn.addEventListener("click", calculate);
    el.clearBtn.addEventListener("click", clearAll);
    el.copyBtn.addEventListener("click", copyResult);
    el.shareBtn.addEventListener("click", shareResult);
    el.downloadBtn.addEventListener("click", downloadPNG);

    resetResults();
  </script>
</body>
</html>
