```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>FYNX ‚Äî Journal</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    *{margin:0;padding:0;box-sizing:border-box}

    :root{
      --bg:#ffffff;
      --text:#0b0b0b;
      --muted:#7a7a7a;
      --stroke:#eeeeee;
      --panel:#fbfbfb;
      --card:#ffffff;
      --cardStroke:#ededed;

      --j-bg:#07080a;
      --j-text:rgba(255,255,255,.92);
      --j-muted:rgba(255,255,255,.60);
      --j-stroke:rgba(255,255,255,.10);
      --j-card:rgba(0,0,0,.22);
      --j-good:#46e6a6;
      --j-bad:#ff4d6d;
    }

    body{
      font-family:'Inter',-apple-system,BlinkMacSystemFont,'SF Pro Display',system-ui,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg);
      color:var(--text);
      height:100vh;
      overflow:hidden;
    }

    body.dark-mode{
      --bg:#000;
      --text:#fff;
      --muted:rgba(255,255,255,.55);
      --stroke:rgba(255,255,255,.08);
      --panel:#000;
      --card:rgba(255,255,255,.03);
      --cardStroke:rgba(255,255,255,.10);
    }

    .dashboard-container{display:flex;height:100vh;width:100vw}

    /* Sidebar */
    .nav-panel{
      width:104px;
      background:var(--panel);
      border-right:1px solid var(--stroke);
      display:flex;
      flex-direction:column;
      position:fixed;
      left:0;top:0;
      height:100vh;
      z-index:100;
    }

    .nav-logo{
      padding:26px 0;
      text-align:center;
      border-bottom:1px solid var(--stroke);
    }
    .nav-logo h1{
      font-size:16px;
      font-weight:800;
      letter-spacing:.12em;
      color:var(--text);
      user-select:none;
    }

    .nav-menu{
      flex:1;
      padding:22px 0;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:10px;
    }

    .nav-item{
      width:78px;
      padding:14px 0;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:8px;
      cursor:pointer;
      transition:all .18s ease;
      position:relative;
      border-radius:14px;
    }
    .nav-item:hover{background:rgba(0,0,0,.05)}
    body.dark-mode .nav-item:hover{background:rgba(255,255,255,.05)}

    .nav-item.active{background:rgba(0,0,0,.03)}
    body.dark-mode .nav-item.active{background:rgba(255,255,255,.08)}

    .nav-item.active::after{
      content:'';
      position:absolute;
      left:0;
      top:50%;
      transform:translateY(-50%);
      width:3px;
      height:26px;
      background:var(--text);
      border-radius:0 3px 3px 0;
    }

    .nav-icon{
      width:22px;height:22px;
      stroke:rgba(0,0,0,.55);
      stroke-width:1.7;
      fill:none;
      transition:stroke .18s ease;
    }
    body.dark-mode .nav-icon{stroke:rgba(255,255,255,.55)}
    .nav-item.active .nav-icon,
    .nav-item:hover .nav-icon{stroke:var(--text)}

    .nav-label{
      font-size:11px;
      font-weight:600;
      letter-spacing:.01em;
      color:rgba(0,0,0,.48);
      transition:color .18s ease;
      user-select:none;
    }
    body.dark-mode .nav-label{color:rgba(255,255,255,.55)}
    .nav-item.active .nav-label,
    .nav-item:hover .nav-label{color:var(--text)}

    /* Main */
    .main-content{
      margin-left:104px;
      flex:1;
      display:flex;
      flex-direction:column;
      height:100vh;
      overflow:hidden;
      background:var(--bg);
    }

    .top-bar{
      height:64px;
      border-bottom:1px solid var(--stroke);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 42px;
      background:var(--bg);
    }

    .page-title{
      font-size:14px;
      font-weight:700;
      color:var(--muted);
      letter-spacing:.01em;
    }

    .top-bar-right{display:flex;align-items:center;gap:18px}

    /* Theme toggle removed here (must exist ONLY on Profile) */
    .theme-toggle{display:none}

    .notification-icon{
      width:20px;height:20px;
      stroke:var(--text);stroke-width:1.7;fill:none;
      opacity:.5;cursor:pointer;transition:opacity .18s ease;
    }
    .notification-icon:hover{opacity:1}

    .user-avatar{
      width:34px;height:34px;
      border-radius:999px;
      background:rgba(0,0,0,.06);
      border:1px solid rgba(0,0,0,.08);
      display:flex;align-items:center;justify-content:center;
      font-size:12px;font-weight:800;color:rgba(0,0,0,.55);
      cursor:pointer;
      transition:transform .18s ease,border-color .18s ease;
      user-select:none;
    }
    body.dark-mode .user-avatar{
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      color:rgba(255,255,255,.75);
    }
    .user-avatar:hover{transform:scale(1.05);}

    /* Content */
    .content-area{
      flex:1;
      overflow-y:auto;
      padding:26px 42px;
      background:var(--bg);
    }

    /* Journal inner shell (Grok-style, but inside normal page) */
    .journal-shell{
      border:1px solid var(--cardStroke);
      border-radius:18px;
      background: linear-gradient(180deg, rgba(0,0,0,.02), rgba(0,0,0,.01));
      overflow:hidden;
    }
    body.dark-mode .journal-shell{
      background: radial-gradient(1200px 900px at 20% -10%, rgba(255,255,255,.08), transparent 60%),
                  radial-gradient(900px 700px at 90% 10%, rgba(255,255,255,.06), transparent 55%),
                  linear-gradient(180deg, var(--j-bg), #05060a 55%, #040509);
      border-color: rgba(255,255,255,.10);
    }

    .journal-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:16px 18px;
      border-bottom:1px solid var(--cardStroke);
      background: rgba(255,255,255,.70);
      backdrop-filter: blur(10px);
    }
    body.dark-mode .journal-top{
      background: rgba(7,8,10,.35);
      border-bottom:1px solid rgba(255,255,255,.10);
    }

    .jt-title{
      display:flex;
      flex-direction:column;
      line-height:1.1;
    }
    .jt-title b{font-size:14px}
    .jt-title small{font-size:12px;color:var(--muted)}
    body.dark-mode .jt-title b{color:var(--j-text)}
    body.dark-mode .jt-title small{color:var(--j-muted)}

    .jt-right{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .pill{
      display:flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:999px;
      background: rgba(0,0,0,.04);
      border:1px solid rgba(0,0,0,.08);
      color: rgba(0,0,0,.70);
      font-size:12px;
    }
    body.dark-mode .pill{
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.10);
      color: rgba(255,255,255,.82);
    }
    .pill input, .pill select{
      border:none; outline:none;
      background: transparent;
      color: inherit;
      font-size:12px;
    }
    .pill input{width:120px}
    .pill button{
      border:none; outline:none;
      background: transparent;
      color: inherit;
      cursor:pointer;
      font-weight:800;
    }

    .journal-body{
      display:flex;
      min-height: 640px;
    }

    /* Inner Journal Nav (smaller) */
    .jnav{
      width: 220px;
      border-right:1px solid var(--cardStroke);
      padding:14px;
      background: rgba(255,255,255,.55);
    }
    body.dark-mode .jnav{
      background: rgba(0,0,0,.22);
      border-right:1px solid rgba(255,255,255,.10);
    }

    .jbtn{
      width:100%;
      display:flex;
      align-items:center;
      gap:10px;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid transparent;
      background: transparent;
      cursor:pointer;
      transition:.16s ease;
      color: rgba(0,0,0,.72);
      font-weight:800;
      font-size:12px;
      text-align:left;
    }
    body.dark-mode .jbtn{ color: rgba(255,255,255,.78); }
    .jbtn:hover{ background: rgba(0,0,0,.04); border-color: rgba(0,0,0,.08); }
    body.dark-mode .jbtn:hover{ background: rgba(255,255,255,.06); border-color: rgba(255,255,255,.12); }

    .jbtn.active{
      background: rgba(0,0,0,.06);
      border-color: rgba(0,0,0,.12);
      color: rgba(0,0,0,.88);
    }
    body.dark-mode .jbtn.active{
      background: rgba(255,255,255,.08);
      border-color: rgba(255,255,255,.16);
      color: rgba(255,255,255,.92);
    }

    .jico{width:18px;height:18px;stroke:currentColor;stroke-width:1.8;fill:none;opacity:.9}

    .jcontent{
      flex:1;
      padding:16px 16px 18px 16px;
    }

    .grid{display:grid;gap:14px}
    .grid.cols-12{grid-template-columns:repeat(12,minmax(0,1fr))}
    .card{
      background: var(--card);
      border:1px solid var(--cardStroke);
      border-radius:18px;
      overflow:hidden;
    }
    body.dark-mode .card{
      background: rgba(0,0,0,.22);
      border-color: rgba(255,255,255,.10);
    }
    .hd{
      padding:14px 16px 10px 16px;
      border-bottom:1px solid rgba(0,0,0,.06);
      display:flex;align-items:flex-end;justify-content:space-between;gap:10px
    }
    body.dark-mode .hd{border-bottom:1px solid rgba(255,255,255,.08)}
    .hd b{font-size:13px}
    .hd small{font-size:12px;color:var(--muted)}
    body.dark-mode .hd b{color:var(--j-text)}
    body.dark-mode .hd small{color:var(--j-muted)}
    .bd{padding:14px 16px 16px 16px}

    .stat{
      padding:14px 16px;
      border-radius:14px;
      border:1px solid rgba(0,0,0,.06);
      background: rgba(0,0,0,.02);
      display:flex;flex-direction:column;gap:6px
    }
    body.dark-mode .stat{
      border-color: rgba(255,255,255,.08);
      background: rgba(0,0,0,.18);
    }
    .stat small{font-size:12px;color:var(--muted)}
    .stat b{font-size:22px}
    body.dark-mode .stat small{color:var(--j-muted)}
    body.dark-mode .stat b{color:var(--j-text)}
    .good{color:var(--j-good)!important}
    .bad{color:var(--j-bad)!important}

    .row{
      display:flex;align-items:center;justify-content:space-between;
      gap:10px;padding:10px 0;border-bottom:1px dashed rgba(0,0,0,.10)
    }
    body.dark-mode .row{border-bottom:1px dashed rgba(255,255,255,.10)}
    .row:last-child{border-bottom:none}
    .row .l{display:flex;flex-direction:column;gap:2px;min-width:0}
    .row .l b{font-size:12px}
    .row .l small{font-size:12px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    body.dark-mode .row .l b{color:rgba(255,255,255,.90)}
    body.dark-mode .row .l small{color:rgba(255,255,255,.60)}
    .badge{
      font-size:11px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(0,0,0,.10);
      background: rgba(0,0,0,.03);
      color: rgba(0,0,0,.70);
      white-space:nowrap;
    }
    body.dark-mode .badge{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color: rgba(255,255,255,.82);
    }

    /* form */
    label{font-size:12px;color:var(--muted)}
    body.dark-mode label{color:rgba(255,255,255,.60)}
    input[type="text"], input[type="number"], input[type="date"], textarea, select{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(0,0,0,.10);
      background: rgba(0,0,0,.03);
      color: rgba(0,0,0,.88);
      outline:none;
    }
    body.dark-mode input, body.dark-mode textarea, body.dark-mode select{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.22);
      color: rgba(255,255,255,.90);
    }
    textarea{min-height:110px;resize:vertical}

    .btn{
      padding:12px 14px;
      border-radius: 14px;
      border:1px solid rgba(0,0,0,.12);
      background: rgba(0,0,0,.04);
      color: rgba(0,0,0,.85);
      cursor:pointer;
      font-weight:900;
      font-size:12px;
      transition:.16s ease;
    }
    body.dark-mode .btn{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.90);
    }
    .btn:hover{background: rgba(0,0,0,.06)}
    body.dark-mode .btn:hover{background: rgba(255,255,255,.10)}
    .btn.ghost{background:transparent}

    .note{
      font-size:12px;
      color: var(--muted);
      margin-top:10px;
    }
    body.dark-mode .note{color: rgba(255,255,255,.55)}

    section.view{display:none}
    section.view.active{display:block}

    /* =========================
       MOBILE (iPhone perfect fit)
    ========================= */
    @media (max-width: 980px){
      .jnav{width: 190px}
      .grid.cols-12{grid-template-columns:repeat(6,minmax(0,1fr))}
    }

    @media (max-width: 820px){
      .top-bar{padding:0 18px}
      .content-area{padding:18px}
      .journal-body{flex-direction:column}
      .jnav{
        width:100%;
        display:flex;
        gap:10px;
        overflow:auto;
        border-right:none;
        border-bottom:1px solid var(--cardStroke);
        -webkit-overflow-scrolling:touch;
        padding-bottom:10px;
      }
      body.dark-mode .jnav{border-bottom:1px solid rgba(255,255,255,.10)}
      .jbtn{min-width: 210px}
    }

    @media (max-width: 720px){
      /* Outer nav becomes bottom bar like Home, fixed + safe area */
      .nav-panel{
        width:100%;
        height:74px;
        bottom:0;
        top:auto;
        left:0;
        right:0;
        border-right:none;
        border-top:1px solid var(--stroke);
        flex-direction:row;
        align-items:center;
        justify-content:center;
        padding-bottom: env(safe-area-inset-bottom);
        background:var(--panel);
      }
      .nav-logo{ display:none; }
      .nav-menu{
        flex-direction:row;
        width:100%;
        justify-content:space-around;
        padding:8px 10px;
        gap:8px;
      }
      .nav-item{
        width:auto;
        min-width:56px;
        padding:10px 10px;
      }
      .nav-item.active::after{ display:none; }

      .main-content{
        margin-left:0;
        width:100%;
        padding-bottom: calc(88px + env(safe-area-inset-bottom));
      }

      /* Make top bar tighter on iPhone + avoid overflow */
      .top-bar{
        padding:0 14px;
      }
      .top-bar-right{
        gap:12px;
      }

      /* Content padding tighter */
      .content-area{
        padding:14px;
      }

      /* Journal top stacks nicely on iPhone */
      .journal-top{
        flex-direction:column;
        align-items:flex-start;
      }
      .jt-right{
        width:100%;
        justify-content:flex-start;
      }

      /* pills wrap and never overflow */
      .pill{
        flex:1 1 auto;
      }
      .pill input{
        width:100%;
        min-width:120px;
      }

      /* Make grid blocks full width on mobile */
      .grid.cols-12{ grid-template-columns:repeat(12,minmax(0,1fr)); }
      .stat{ grid-column: span 12 !important; }
      .card[style*="grid-column: span 8"]{ grid-column: span 12 !important; }
      .card[style*="grid-column: span 4"]{ grid-column: span 12 !important; }

      /* Entry form: force single column */
      #view-entry .bd .grid{
        grid-template-columns: 1fr !important;
      }
      #view-entry .bd .grid > div{
        grid-column: span 12 !important;
      }

      /* Charts: ensure visible height on iPhone */
      canvas{ max-width:100%; }
      #equityChart{ height:180px !important; }
      #winTrendChart{ height:180px !important; }
      #sessionPLChart{ height:220px !important; }
    }
  </style>
</head>

<body>
  <div class="dashboard-container">
    <!-- Outer Sidebar -->
    <nav class="nav-panel">
      <div class="nav-logo"><h1>FYNX</h1></div>

      <div class="nav-menu">
        <div class="nav-item" data-view="home">
          <svg class="nav-icon" viewBox="0 0 24 24">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
          </svg>
          <span class="nav-label">Home</span>
        </div>

        <div class="nav-item active" data-view="journal">
          <svg class="nav-icon" viewBox="0 0 24 24">
            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
          </svg>
          <span class="nav-label">Journal</span>
        </div>

        <div class="nav-item" data-view="calculator">
          <svg class="nav-icon" viewBox="0 0 24 24">
            <rect x="4" y="2" width="16" height="20" rx="2"></rect>
            <line x1="8" y1="6" x2="16" y2="6"></line>
            <line x1="8" y1="10" x2="16" y2="10"></line>
            <line x1="8" y1="14" x2="16" y2="14"></line>
            <line x1="8" y1="18" x2="16" y2="18"></line>
          </svg>
          <span class="nav-label">Calculator</span>
        </div>

        <div class="nav-item" data-view="news">
          <svg class="nav-icon" viewBox="0 0 24 24">
            <path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-2 2zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2"></path>
            <line x1="12" y1="11" x2="18" y2="11"></line>
            <line x1="12" y1="7" x2="18" y2="7"></line>
          </svg>
          <span class="nav-label">News</span>
        </div>

        <div class="nav-item" data-view="calendar">
          <svg class="nav-icon" viewBox="0 0 24 24">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          <span class="nav-label">Calendar</span>
        </div>

        <div class="nav-item" data-view="profile">
          <svg class="nav-icon" viewBox="0 0 24 24">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
          <span class="nav-label">Profile</span>
        </div>
      </div>
    </nav>

    <!-- Main -->
    <main class="main-content">
      <div class="top-bar">
        <h1 class="page-title">Journal</h1>

        <div class="top-bar-right">
          <!-- Theme toggle REMOVED here (ONLY on Profile now) -->

          <svg class="notification-icon" viewBox="0 0 24 24" title="Notifications">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
          </svg>

          <div class="user-avatar" id="avatar" title="Profile">FX</div>
        </div>
      </div>

      <div class="content-area">
        <div class="journal-shell">
          <div class="journal-top">
            <div class="jt-title">
              <b>Trader Journal</b>
              <small id="modeText">Guest mode (view only) ‚Äî login to save</small>
            </div>

            <div class="jt-right">
              <div class="pill" title="Date range (visual only)">
                <span style="opacity:.85;">üóì</span>
                <input type="text" value="Last 30 days" aria-label="Date range" />
              </div>
              <div class="pill" title="Account">
                <span style="opacity:.85;">‚óé</span>
                <select aria-label="Account">
                  <option>Live</option>
                  <option>Demo</option>
                  <option>Prop</option>
                </select>
              </div>
              <div class="pill">
                <button id="quickAddBtn" type="button">Quick Add</button>
              </div>
            </div>
          </div>

          <div class="journal-body">
            <!-- Inner Journal Nav -->
            <aside class="jnav" aria-label="Journal Navigation">
              <button class="jbtn active" data-view="dash">
                <svg class="jico" viewBox="0 0 24 24"><rect x="3" y="3" width="8" height="8" rx="2"></rect><rect x="13" y="3" width="8" height="8" rx="2"></rect><rect x="3" y="13" width="8" height="8" rx="2"></rect><rect x="13" y="13" width="8" height="8" rx="2"></rect></svg>
                Dashboard
              </button>

              <button class="jbtn" data-view="entry">
                <svg class="jico" viewBox="0 0 24 24"><path d="M12 5v14"></path><path d="M5 12h14"></path></svg>
                New Trade Entry
              </button>

              <button class="jbtn" data-view="analytics">
                <svg class="jico" viewBox="0 0 24 24"><path d="M4 19V5"></path><path d="M4 19h16"></path><path d="M8 15v-5"></path><path d="M12 19v-9"></path><path d="M16 19v-12"></path></svg>
                Performance Analytics
              </button>

              <button class="jbtn" data-view="replay">
                <svg class="jico" viewBox="0 0 24 24"><path d="M8 5v14l12-7-12-7z"></path></svg>
                Trade Replay
              </button>

              <button class="jbtn" data-view="streaks">
                <svg class="jico" viewBox="0 0 24 24"><path d="M13 2L3 14h7l-1 8 12-14h-7l-1-6z"></path></svg>
                Streaks & Discipline
              </button>

              <button class="jbtn" data-view="calendar">
                <svg class="jico" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2"></rect><path d="M16 2v4"></path><path d="M8 2v4"></path><path d="M3 10h18"></path></svg>
                Trading Calendar
              </button>

              <div class="note">
                Export removed (it was just a JSON backup download).
              </div>
            </aside>

            <!-- Inner Content -->
            <div class="jcontent">
              <!-- DASH -->
              <section class="view active" id="view-dash">
                <div class="grid cols-12">
                  <div class="card" style="grid-column: span 12;">
                    <div class="hd">
                      <div>
                        <b>Welcome back, Trader</b>
                        <small>Here‚Äôs your performance snapshot</small>
                      </div>
                      <div class="badge">Journal v1</div>
                    </div>

                    <div class="bd">
                      <div class="grid cols-12">
                        <div class="stat" style="grid-column: span 3;">
                          <small>Total Trades</small>
                          <b id="kpiTrades">0</b>
                          <div class="row" style="border-bottom:none;padding:8px 0 0 0;">
                            <div class="l"><small>vs last period</small></div>
                            <div class="r"><span class="badge" id="kpiTradesDelta">‚Äî</span></div>
                          </div>
                        </div>

                        <div class="stat" style="grid-column: span 3;">
                          <small>Win Rate</small>
                          <b id="kpiWin">0.0%</b>
                          <div class="row" style="border-bottom:none;padding:8px 0 0 0;">
                            <div class="l"><small>improvement</small></div>
                            <div class="r"><span class="badge" id="kpiWinDelta">‚Äî</span></div>
                          </div>
                        </div>

                        <div class="stat" style="grid-column: span 3;">
                          <small>Total P/L</small>
                          <b id="kpiPL">+$0</b>
                          <div class="row" style="border-bottom:none;padding:8px 0 0 0;">
                            <div class="l"><small>realized</small></div>
                            <div class="r"><span class="badge" id="kpiPLDelta">‚Äî</span></div>
                          </div>
                        </div>

                        <div class="stat" style="grid-column: span 3;">
                          <small>Daily Streak</small>
                          <b id="kpiStreak">0</b>
                          <div class="row" style="border-bottom:none;padding:8px 0 0 0;">
                            <div class="l"><small>days logged</small></div>
                            <div class="r"><span class="badge">days</span></div>
                          </div>
                        </div>

                        <div class="card" style="grid-column: span 8;">
                          <div class="hd">
                            <b>Equity Curve</b>
                            <small>Net P/L over time</small>
                          </div>
                          <div class="bd" style="height:260px;">
                            <canvas id="equityChart"></canvas>
                          </div>
                        </div>

                        <div class="card" style="grid-column: span 4;">
                          <div class="hd">
                            <b>Session Performance</b>
                            <small>Where you win</small>
                          </div>
                          <div class="bd" id="sessionList"></div>
                        </div>

                      </div>
                    </div>
                  </div>
                </div>
              </section>

              <!-- ENTRY -->
              <section class="view" id="view-entry">
                <div class="card">
                  <div class="hd">
                    <div>
                      <b>New Trade Entry</b>
                      <small>Log the trade the same day. Keep it clean.</small>
                    </div>
                    <div style="display:flex; gap:10px; flex-wrap:wrap;">
                      <button class="btn ghost" id="resetFormBtn" type="button">Reset</button>
                      <button class="btn" id="saveTradeBtn" type="button">Save Trade</button>
                    </div>
                  </div>
                  <div class="bd">
                    <div class="grid" style="grid-template-columns: repeat(12, minmax(0,1fr)); gap:14px;">
                      <div style="grid-column: span 6;">
                        <label>Symbol</label>
                        <input id="fSymbol" type="text" placeholder="EURUSD / XAUUSD / BTCUSD" />
                      </div>
                      <div style="grid-column: span 6;">
                        <label>Date</label>
                        <input id="fDate" type="date" />
                      </div>
                      <div style="grid-column: span 4;">
                        <label>Entry</label>
                        <input id="fEntry" type="number" step="0.00001" placeholder="0.00000" />
                      </div>
                      <div style="grid-column: span 4;">
                        <label>Stop Loss</label>
                        <input id="fSL" type="number" step="0.00001" placeholder="0.00000" />
                      </div>
                      <div style="grid-column: span 4;">
                        <label>Take Profit</label>
                        <input id="fTP" type="number" step="0.00001" placeholder="0.00000" />
                      </div>
                      <div style="grid-column: span 12;">
                        <label>Notes</label>
                        <textarea id="fNotes" placeholder="Plan, execution, mistakes, next improvement..."></textarea>
                      </div>

                      <div style="grid-column: span 12; display:flex; gap:10px; flex-wrap:wrap;">
                        <span class="badge" id="qRR">R:R ‚Äî</span>
                        <span class="badge" id="qRisk">Risk ‚Äî</span>
                        <span class="badge" id="qReward">Reward ‚Äî</span>
                      </div>

                      <div class="note" id="loginNote" style="grid-column: span 12; display:none;">
                        You‚Äôre in guest mode. To save trades, you must login. Redirecting to login when you click ‚ÄúSave‚Äù.
                      </div>
                    </div>
                  </div>
                </div>
              </section>

              <!-- ANALYTICS -->
              <section class="view" id="view-analytics">
                <div class="card">
                  <div class="hd">
                    <div>
                      <b>Performance Analytics</b>
                      <small>Win trend + session P/L</small>
                    </div>
                    <div class="badge" id="tradeCountBadge">Trades: 0</div>
                  </div>
                  <div class="bd">
                    <div class="grid cols-12">
                      <div class="card" style="grid-column: span 8;">
                        <div class="hd"><b>Win Rate Trend</b><small>Rolling performance</small></div>
                        <div class="bd" style="height:260px;">
                          <canvas id="winTrendChart"></canvas>
                        </div>
                      </div>
                      <div class="card" style="grid-column: span 4;">
                        <div class="hd"><b>P/L by Session</b><small>Where money is made</small></div>
                        <div class="bd" style="height:260px;">
                          <canvas id="sessionPLChart"></canvas>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </section>

              <!-- REPLAY -->
              <section class="view" id="view-replay">
                <div class="card">
                  <div class="hd">
                    <div>
                      <b>Trade Replay</b>
                      <small>Review the last saved trade</small>
                    </div>
                    <div style="display:flex; gap:10px;">
                      <button class="btn ghost" id="prevTradeBtn" type="button">Previous</button>
                      <button class="btn ghost" id="nextTradeBtn" type="button">Next</button>
                    </div>
                  </div>
                  <div class="bd" id="replaySummary"></div>
                </div>
              </section>

              <!-- STREAKS -->
              <section class="view" id="view-streaks">
                <div class="card">
                  <div class="hd">
                    <div><b>Streaks & Discipline</b><small>Consistency beats intensity</small></div>
                    <div class="badge" id="sBadge">‚Äî</div>
                  </div>
                  <div class="bd" id="streakBox"></div>
                </div>
              </section>

              <!-- CALENDAR -->
              <section class="view" id="view-calendar">
                <div class="card">
                  <div class="hd">
                    <div><b>Trading Calendar</b><small>Monthly overview</small></div>
                    <div class="badge" id="calBadge">This month</div>
                  </div>
                  <div class="bd" id="calendarBox"></div>
                </div>
              </section>

            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore-compat.js"></script>

  <script>
    /* =========================
       THEME (apply saved only)
       (Toggle button lives ONLY on profile.html)
    ========================= */
    const THEME_KEY = "fynx_theme";
    function applySavedTheme(){
      const t = localStorage.getItem(THEME_KEY) || "light";
      document.body.classList.toggle("dark-mode", t === "dark");
    }
    applySavedTheme();

    /* =========================
       OUTER NAV (normal pages)
    ========================= */
    const navItems = document.querySelectorAll('.nav-item');
    const viewPages = {
      home: 'home.html',
      journal: 'journal.html',
      calculator: 'calculator.html',
      news: 'news.html',
      calendar: 'calendar.html',
      profile: 'profile.html'
    };

    navItems.forEach(item => {
      item.addEventListener('click', () => {
        const viewName = item.getAttribute('data-view');
        if (viewPages[viewName]) window.location.href = viewPages[viewName];
      });
    });

    /* =========================
       JOURNAL APP (guest + live)
    ========================= */
    const firebaseConfig = {
      apiKey: "AIzaSyDGSYIB_YIpbWyUMJ1d-v00-xADnvaWckk",
      authDomain: "fynx-c7a28.firebaseapp.com",
      databaseURL: "https://fynx-c7a28-default-rtdb.firebaseio.com",
      projectId: "fynx-c7a28",
      storageBucket: "fynx-c7a28.firebasestorage.app",
      messagingSenderId: "1011050657868",
      appId: "1:1011050657868:web:2c5ad5a1b275e669b05ce9",
      measurementId: "G-SDW6273VYJ"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const modeText = document.getElementById("modeText");
    const loginNote = document.getElementById("loginNote");
    const avatar = document.getElementById("avatar");

    // inner nav
    const jBtns = [...document.querySelectorAll(".jbtn[data-view]")];
    const views = {
      dash: document.getElementById("view-dash"),
      entry: document.getElementById("view-entry"),
      analytics: document.getElementById("view-analytics"),
      replay: document.getElementById("view-replay"),
      streaks: document.getElementById("view-streaks"),
      calendar: document.getElementById("view-calendar"),
    };

    function setActiveView(key){
      jBtns.forEach(b => b.classList.toggle("active", b.dataset.view === key));
      Object.entries(views).forEach(([k, el]) => el.classList.toggle("active", k === key));
      if (key === "dash") refreshDashboard();
      if (key === "analytics") refreshAnalytics();
      if (key === "replay") refreshReplay();
      if (key === "streaks") refreshStreaks();
      if (key === "calendar") refreshCalendar();
    }
    jBtns.forEach(btn => btn.addEventListener("click", () => setActiveView(btn.dataset.view)));
    document.getElementById("quickAddBtn").addEventListener("click", () => setActiveView("entry"));

    // State
    let currentUid = null;
    let unsubTrades = null;
    let state = { trades: [] };
    let replayIndex = 0;

    const tradesCol = () => db.collection("users").doc(currentUid).collection("trades");

    // Demo trades for guest view
    const demoTrades = [
      { id:"d1", date:"2026-01-29", symbol:"XAUUSD", session:"New York", pl: 120 },
      { id:"d2", date:"2026-01-28", symbol:"EURUSD", session:"London", pl: -55 },
      { id:"d3", date:"2026-01-27", symbol:"BTCUSD", session:"Asia", pl: 80 }
    ];

    // Charts
    let equityChart, winTrendChart, sessionPLChart;

    function mkChartDefaults(){
      const dark = document.body.classList.contains("dark-mode");
      const tick = dark ? "rgba(255,255,255,.55)" : "rgba(0,0,0,.45)";
      const grid = dark ? "rgba(255,255,255,.10)" : "rgba(0,0,0,.08)";
      const line = dark ? "rgba(255,255,255,.85)" : "rgba(0,0,0,.75)";
      const fill = dark ? "rgba(255,255,255,.08)" : "rgba(0,0,0,.06)";
      return { tick, grid, line, fill };
    }

    function initCharts(){
      const c = mkChartDefaults();

      equityChart = new Chart(document.getElementById("equityChart"), {
        type:"line",
        data:{ labels:[], datasets:[{
          label:"Equity",
          data:[],
          borderColor:c.line,
          backgroundColor:c.fill,
          fill:true, tension:.35, pointRadius:0
        }]},
        options:{
          responsive:true, maintainAspectRatio:false,
          plugins:{ legend:{ labels:{ color:c.tick, font:{ size:11 } } } },
          scales:{
            x:{ ticks:{ color:c.tick }, grid:{ color:c.grid } },
            y:{ ticks:{ color:c.tick }, grid:{ color:c.grid } }
          }
        }
      });

      winTrendChart = new Chart(document.getElementById("winTrendChart"), {
        type:"line",
        data:{ labels:[], datasets:[{
          label:"Win Rate % (rolling)",
          data:[],
          borderColor:c.line,
          backgroundColor:c.fill,
          fill:true, tension:.35, pointRadius:0
        }]},
        options:{
          responsive:true, maintainAspectRatio:false,
          plugins:{ legend:{ labels:{ color:c.tick, font:{ size:11 } } } },
          scales:{
            x:{ ticks:{ color:c.tick }, grid:{ color:c.grid } },
            y:{ ticks:{ color:c.tick }, grid:{ color:c.grid } }
          }
        }
      });

      sessionPLChart = new Chart(document.getElementById("sessionPLChart"), {
        type:"bar",
        data:{ labels:["London","New York","Asia","Overlap"], datasets:[{
          label:"Net P/L",
          data:[0,0,0,0],
          borderColor:c.line,
          backgroundColor:c.fill
        }]},
        options:{
          responsive:true, maintainAspectRatio:false,
          plugins:{ legend:{ labels:{ color:c.tick, font:{ size:11 } } } },
          scales:{
            x:{ ticks:{ color:c.tick }, grid:{ color:c.grid } },
            y:{ ticks:{ color:c.tick }, grid:{ color:c.grid } }
          }
        }
      });
    }

    function rebuildChartsTheme(){
      const c = mkChartDefaults();
      [equityChart, winTrendChart, sessionPLChart].forEach(ch => {
        if(!ch) return;
        ch.data.datasets.forEach(ds => {
          ds.borderColor = c.line;
          ds.backgroundColor = c.fill;
        });
        ch.options.plugins.legend.labels.color = c.tick;
        ch.options.scales.x.ticks.color = c.tick;
        ch.options.scales.y.ticks.color = c.tick;
        ch.options.scales.x.grid.color = c.grid;
        ch.options.scales.y.grid.color = c.grid;
        ch.update();
      });
    }
    window.__updateCharts = rebuildChartsTheme;

    function updateCharts(){
      const trades = [...state.trades].sort((a,b) => String(a.date||"").localeCompare(String(b.date||"")));
      let cum = 0;
      const labels = [];
      const data = [];
      trades.forEach(t => {
        labels.push(String(t.date||"").slice(5) || "‚Äî");
        cum += (t.pl || 0);
        data.push(Number(cum.toFixed(2)));
      });
      equityChart.data.labels = labels;
      equityChart.data.datasets[0].data = data;
      equityChart.update();

      // rolling win rate
      const wlabels=[], wdata=[];
      const winArr = trades.map(t => (t.pl||0) > 0 ? 1 : 0);
      for(let i=0;i<trades.length;i++){
        const start = Math.max(0, i-9);
        const slice = winArr.slice(start, i+1);
        const wr = slice.length ? (slice.reduce((a,b)=>a+b,0)/slice.length)*100 : 0;
        wlabels.push(String(trades[i].date||"").slice(5) || "‚Äî");
        wdata.push(Number(wr.toFixed(1)));
      }
      winTrendChart.data.labels = wlabels;
      winTrendChart.data.datasets[0].data = wdata;
      winTrendChart.update();

      // session PL
      const sessions = { "London":0, "New York":0, "Asia":0, "Overlap":0 };
      trades.forEach(t => { sessions[t.session] = (sessions[t.session]||0) + (t.pl||0); });
      sessionPLChart.data.datasets[0].data = [
        sessions["London"]||0,
        sessions["New York"]||0,
        sessions["Asia"]||0,
        sessions["Overlap"]||0
      ].map(x => Number(x.toFixed(2)));
      sessionPLChart.update();
    }

    function refreshDashboard(){
      const total = state.trades.length;
      document.getElementById("kpiTrades").textContent = String(total);

      const wins = state.trades.filter(t => (t.pl||0) > 0).length;
      const wr = total ? (wins/total)*100 : 0;
      document.getElementById("kpiWin").textContent = `${wr.toFixed(1)}%`;

      const totalPL = state.trades.reduce((a,t)=>a+(t.pl||0),0);
      const kpiPL = document.getElementById("kpiPL");
      kpiPL.textContent = `${totalPL>=0?"+":"-"}$${Math.abs(totalPL).toFixed(0)}`;
      kpiPL.className = totalPL >= 0 ? "good" : "bad";

      // streak (simple consecutive days)
      const dates = [...new Set(state.trades.map(t => t.date).filter(Boolean))].sort();
      let streak = 0;
      if(dates.length){
        const today = new Date(); today.setHours(0,0,0,0);
        const set = new Set(dates);
        while(true){
          const d = new Date(today);
          d.setDate(d.getDate() - streak);
          const iso = d.toISOString().slice(0,10);
          if(set.has(iso)) streak++;
          else break;
        }
      }
      document.getElementById("kpiStreak").textContent = String(streak);

      // session list
      const bySession = {};
      state.trades.forEach(t => bySession[t.session] = (bySession[t.session]||0) + (t.pl||0));
      const order = ["London","New York","Asia","Overlap"];
      document.getElementById("sessionList").innerHTML = order.map(name => {
        const val = bySession[name] || 0;
        const cls = val >= 0 ? "good" : "bad";
        return `
          <div class="row">
            <div class="l"><b>${name}</b><small>Net P/L</small></div>
            <div class="r"><span class="badge ${cls}">${val>=0?"+":"-"}$${Math.abs(val).toFixed(0)}</span></div>
          </div>`;
      }).join("");
    }

    function refreshAnalytics(){
      document.getElementById("tradeCountBadge").textContent = `Trades: ${state.trades.length}`;
    }

    function refreshReplay(){
      const box = document.getElementById("replaySummary");
      if(state.trades.length === 0){
        box.innerHTML = `<div class="note">No trades yet.</div>`;
        return;
      }
      replayIndex = Math.max(0, Math.min(replayIndex, state.trades.length - 1));
      const t = state.trades[replayIndex];
      const pl = t.pl || 0;
      const cls = pl >= 0 ? "good" : "bad";
      box.innerHTML = `
        <div class="row">
          <div class="l"><b>${t.symbol || "‚Äî"}</b><small>${t.date || "‚Äî"} ¬∑ ${t.session || "‚Äî"}</small></div>
          <div class="r"><span class="badge ${cls}">${pl>=0?"+":"-"}$${Math.abs(pl).toFixed(0)}</span></div>
        </div>
        <div class="note">This is a simplified replay box. If you want, I‚Äôll bring back the full replay UI with screenshot + notes.</div>
      `;
    }

    function refreshStreaks(){
      document.getElementById("sBadge").textContent = `${new Set(state.trades.map(t=>t.date)).size} days logged`;
      document.getElementById("streakBox").innerHTML = `<div class="note">Streaks UI can be expanded next (heatmap + discipline score).</div>`;
    }

    function refreshCalendar(){
      document.getElementById("calendarBox").innerHTML = `<div class="note">Calendar UI can be expanded next (monthly heatmap like your Grok design).</div>`;
    }

    // Entry form helpers
    const fEntry = document.getElementById("fEntry");
    const fSL = document.getElementById("fSL");
    const fTP = document.getElementById("fTP");
    const qRisk = document.getElementById("qRisk");
    const qReward = document.getElementById("qReward");
    const qRR = document.getElementById("qRR");

    function calcStats(){
      const e = parseFloat(fEntry.value);
      const sl = parseFloat(fSL.value);
      const tp = parseFloat(fTP.value);
      if(!isFinite(e) || !isFinite(sl) || !isFinite(tp)){
        qRisk.textContent = "Risk ‚Äî";
        qReward.textContent = "Reward ‚Äî";
        qRR.textContent = "R:R ‚Äî";
        return;
      }
      const risk = Math.abs(e - sl);
      const reward = Math.abs(tp - e);
      const rr = risk > 0 ? (reward / risk) : 0;
      qRisk.textContent = `Risk ${risk.toFixed(2)}`;
      qReward.textContent = `Reward ${reward.toFixed(2)}`;
      qRR.textContent = `R:R ${rr.toFixed(2)}`;
    }
    [fEntry,fSL,fTP].forEach(el => el.addEventListener("input", calcStats));

    function clearForm(){
      document.getElementById("fSymbol").value = "";
      document.getElementById("fDate").valueAsDate = new Date();
      fEntry.value = "";
      fSL.value = "";
      fTP.value = "";
      document.getElementById("fNotes").value = "";
      calcStats();
    }
    document.getElementById("resetFormBtn").addEventListener("click", clearForm);

    document.getElementById("prevTradeBtn").addEventListener("click", () => {
      if(state.trades.length === 0) return;
      replayIndex = Math.max(0, replayIndex - 1);
      refreshReplay();
    });
    document.getElementById("nextTradeBtn").addEventListener("click", () => {
      if(state.trades.length === 0) return;
      replayIndex = Math.min(state.trades.length - 1, replayIndex + 1);
      refreshReplay();
    });

    async function saveTradeLive(){
      const symbol = document.getElementById("fSymbol").value.trim() || "‚Äî";
      const date = document.getElementById("fDate").value || new Date().toISOString().slice(0,10);
      const entry = document.getElementById("fEntry").value;
      const sl = document.getElementById("fSL").value;
      const tp = document.getElementById("fTP").value;
      const notes = document.getElementById("fNotes").value.trim();

      // simple proxy P/L so you see charts moving
      const e = parseFloat(entry), S = parseFloat(sl), T = parseFloat(tp);
      let pl = 0;
      if(isFinite(e) && isFinite(S) && isFinite(T)){
        const reward = Math.abs(T - e);
        const risk = Math.abs(e - S);
        pl = (reward - risk*0.4);
      }

      const tradeId = crypto.randomUUID();
      const dateTs = firebase.firestore.Timestamp.fromDate(new Date(date + "T00:00:00"));

      await tradesCol().doc(tradeId).set({
        id: tradeId,
        symbol, date,
        session: "New York",
        entry, sl, tp,
        notes,
        pl: Number.isFinite(pl) ? pl : 0,
        dateTs,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });

      clearForm();
      setActiveView("replay");
    }

    document.getElementById("saveTradeBtn").addEventListener("click", async () => {
      if(!currentUid){
        loginNote.style.display = "block";
        setTimeout(()=> location.href = "login.html", 600);
        return;
      }
      try{
        await saveTradeLive();
      }catch(err){
        console.error(err);
        alert("Save failed. This is almost always Firestore Rules. See the rules I sent you.");
      }
    });

    function attachTradesListener(){
      if(unsubTrades) unsubTrades();
      unsubTrades = tradesCol().orderBy("dateTs","asc").onSnapshot((snap) => {
        const trades = [];
        snap.forEach(doc => trades.push(doc.data() || {}));
        state.trades = trades;
        replayIndex = Math.max(0, state.trades.length - 1);
        refreshDashboard(); refreshAnalytics(); refreshReplay(); refreshStreaks(); refreshCalendar();
        updateCharts();
      }, (err) => {
        console.error(err);
        alert("Firestore sync failed. This is rules/permissions. Fix rules (below).");
      });
    }

    // Boot
    clearForm();
    initCharts();

    // AUTH: guest shows demo; logged-in shows live
    auth.onAuthStateChanged((user) => {
      if(!user){
        currentUid = null;
        avatar.textContent = "FX";
        modeText.textContent = "Guest mode (view only) ‚Äî login to save";
        loginNote.style.display = "none";
        state.trades = demoTrades;
        refreshDashboard(); refreshAnalytics(); refreshReplay(); refreshStreaks(); refreshCalendar();
        updateCharts();
        return;
      }
      currentUid = user.uid;
      avatar.textContent = "ME";
      modeText.textContent = "Live mode ‚Äî saving to Firestore";
      attachTradesListener();
    });
  </script>
</body>
</html>
```
