<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>FYNX Finance World - Profile</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet" />

  <style>
    :root{
      /* ===== Monochrome System (Light) ===== */
      --bg:#ffffff;
      --surface:#ffffff;
      --surface-2: rgba(11,11,12,0.04);
      --text:#0b0b0c;
      --muted:#5b616a;
      --line: rgba(11,11,12,0.10);

      --accent:#0b0b0c;
      --accent-soft: rgba(11,11,12,0.08);

      --shadow: 0 18px 38px rgba(0,0,0,0.06);
      --radius: 14px;
      --nav-width: 108px;

      --focus: 0 0 0 3px rgba(11,11,12,0.18);
    }

    body.dark-mode{
      /* ===== Monochrome System (Dark) ===== */
      --bg:#000000;
      --surface:#0b0b0c;
      --surface-2: rgba(242,243,245,0.08);
      --text:#f2f3f5;
      --muted:#a9b0bb;
      --line: rgba(242,243,245,0.12);

      --accent:#f2f3f5;
      --accent-soft: rgba(242,243,245,0.10);

      --shadow: 0 20px 44px rgba(0,0,0,0.55);

      --focus: 0 0 0 3px rgba(242,243,245,0.18);
    }

    *{ margin:0; padding:0; box-sizing:border-box; }

    body{
      font-family:"Manrope", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      min-height:100vh;

      /* Light: micro-dots */
      background:
        radial-gradient(circle at 1px 1px, rgba(0,0,0,0.06) 1px, transparent 1px) 0 0 / 18px 18px,
        linear-gradient(var(--bg), var(--bg));
    }

    body.dark-mode{
      /* Dark: grid */
      background:
        linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px) 0 0 / 26px 26px,
        linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px) 0 0 / 26px 26px,
        radial-gradient(circle at 40% 10%, rgba(255,255,255,0.06) 0%, transparent 45%),
        radial-gradient(circle at 70% 0%, rgba(255,255,255,0.04) 0%, transparent 40%),
        linear-gradient(var(--bg), var(--bg));
    }

    .dashboard-container{ display:flex; min-height:100vh; width:100%; }

    /* ===== Sidebar ===== */
    .nav-panel{
      width: var(--nav-width);
      background: color-mix(in oklab, var(--surface) 92%, transparent);
      border-right: 1px solid var(--line);
      position: fixed;
      left:0; top:0;
      height:100vh;
      z-index:100;
      display:flex;
      flex-direction:column;
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
    }

    .nav-logo{
      height:84px;
      border-bottom:1px solid var(--line);
      display:grid;
      place-items:center;
      font-size:24px;
      font-weight:900;
      letter-spacing:-0.7px;
    }

    .nav-menu{
      padding:16px 0;
      display:flex;
      flex-direction:column;
      gap:8px;
      align-items:center;
    }

    .nav-item{
      width:82px;
      border-radius:12px;
      padding:12px 4px;
      display:grid;
      gap:6px;
      place-items:center;
      cursor:pointer;
      color: var(--muted);
      border:1px solid transparent;
      transition:0.18s ease;
      position:relative;
      user-select:none;
      text-decoration:none;
    }

    .nav-item:hover{
      background: var(--surface-2);
      color: var(--text);
      border-color: var(--line);
      transform: translateY(-1px);
    }

    .nav-item.active{
      background: var(--accent-soft);
      color: var(--text);
      border-color: color-mix(in oklab, var(--text) 18%, var(--line));
    }

    .nav-item.active::after{
      content:"";
      position:absolute;
      left:-13px;
      top:50%;
      transform:translateY(-50%);
      width:4px;
      height:30px;
      border-radius:999px;
      background: var(--accent);
      opacity: 0.9;
    }

    .nav-icon{ width:20px; height:20px; stroke:currentColor; stroke-width:1.8; fill:none; }
    .nav-label{ font-size:11px; font-weight:800; }

    .main-content{
      margin-left: var(--nav-width);
      width: calc(100% - var(--nav-width));
      display:flex;
      flex-direction:column;
      min-height:100vh;
    }

    /* ===== Top Bar ===== */
    .top-bar{
      height:72px;
      border-bottom:1px solid var(--line);
      background: color-mix(in oklab, var(--surface) 88%, transparent);
      backdrop-filter: blur(10px);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 24px;
      position:sticky;
      top:0;
      z-index:10;
    }

    .page-title{
      font-size:16px;
      font-weight:900;
      letter-spacing:-0.2px;
    }

    .top-bar-right{
      display:flex;
      align-items:center;
      gap:12px;
      color: var(--muted);
      font-size:13px;
      font-weight:800;
    }

    .icon-btn{
      width:34px;
      height:34px;
      border-radius:10px;
      border:1px solid var(--line);
      background: var(--surface);
      display:grid;
      place-items:center;
      cursor:pointer;
      color: var(--muted);
      transition:0.18s ease;
    }

    .icon-btn:hover{
      color: var(--text);
      border-color: color-mix(in oklab, var(--text) 18%, var(--line));
      transform: translateY(-1px);
    }

    .icon-btn:focus-visible{
      outline:none;
      box-shadow: var(--focus);
    }

    .icon-btn svg{
      width:18px;
      height:18px;
      stroke: currentColor;
      fill:none;
      stroke-width:1.8;
    }

    .user-avatar{
      width:34px; height:34px;
      border-radius:999px;
      background: var(--surface-2);
      border:1px solid var(--line);
      display:grid;
      place-items:center;
      font-size:12px;
      font-weight:900;
      color: var(--muted);
      overflow:hidden;
    }
    .user-avatar img{ width:100%; height:100%; object-fit:cover; display:block; }

    .content-area{
      padding:24px;
      display:grid;
      gap:16px;
    }

    .section-header{ margin-bottom: 6px; }
    .section-header h2{
      font-size:28px;
      line-height:1.1;
      letter-spacing:-0.8px;
      margin-bottom:6px;
      font-weight:900;
    }
    .section-header p{
      color: var(--muted);
      font-size:14px;
      font-weight:800;
    }

    /* ===== Panels ===== */
    .panel{
      background: color-mix(in oklab, var(--surface) 92%, transparent);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }

    .profile-header{
      display:flex;
      align-items:center;
      gap:18px;
      padding:18px;
    }

    .profile-avatar-large{
      width:78px;
      height:78px;
      border-radius:999px;
      background: var(--surface-2);
      border:1px solid var(--line);
      display:grid;
      place-items:center;
      font-size:22px;
      font-weight:900;
      color: var(--muted);
      flex-shrink:0;
      overflow:hidden;
    }
    .profile-avatar-large img{ width:100%; height:100%; object-fit:cover; display:block; }

    .profile-info{ flex:1; min-width:0; }

    .profile-name-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:6px;
    }

    .profile-info h2{
      font-size:18px;
      font-weight:900;
      letter-spacing:-0.3px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .edit-profile-btn{
      padding:8px 12px;
      border:1px solid var(--line);
      border-radius:10px;
      background: var(--surface);
      font-size:12px;
      font-weight:900;
      color: var(--text);
      cursor:pointer;
      transition:0.18s ease;
      white-space:nowrap;
    }
    .edit-profile-btn:hover{
      border-color: color-mix(in oklab, var(--text) 18%, var(--line));
      transform: translateY(-1px);
    }
    .edit-profile-btn:focus-visible{ outline:none; box-shadow: var(--focus); }

    .profile-email{
      font-size:13px;
      color: var(--muted);
      font-weight:800;
      margin-bottom:12px;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }

    .profile-stats{
      display:grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap:10px;
      margin-top: 10px;
    }

    .profile-stat-item{
      border:1px solid var(--line);
      border-radius:12px;
      padding:12px;
      background: var(--surface-2);
      display:grid;
      gap:6px;
    }

    .profile-stat-item h4{
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:0.8px;
      color: var(--muted);
      font-weight:900;
    }

    .profile-stat-item p{
      font-size:18px;
      font-weight:900;
      letter-spacing:-0.4px;
      margin:0;
    }

    .hint{
      margin: 12px 18px 18px;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background: color-mix(in oklab, var(--surface) 90%, var(--surface-2));
      color: var(--muted);
      font-size:12px;
      line-height:1.5;
      font-weight:800;
    }

    .settings-section-title{
      font-size:15px;
      font-weight:900;
      letter-spacing:-0.2px;
      margin: 10px 0 2px;
    }

    .settings-list{ display:flex; flex-direction:column; gap:10px; }

    .settings-item{
      background: color-mix(in oklab, var(--surface) 92%, transparent);
      border:1px solid var(--line);
      border-radius: 14px;
      padding: 14px 14px;
      display:flex;
      align-items:center;
      gap:12px;
      transition:0.18s ease;
      cursor:pointer;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    .settings-item:hover{
      border-color: color-mix(in oklab, var(--text) 18%, var(--line));
      transform: translateY(-1px);
    }

    .settings-icon{ width:20px; height:20px; stroke: var(--muted); stroke-width:1.8; fill:none; }

    .settings-text{ flex:1; min-width:0; }
    .settings-label{ font-size:14px; font-weight:900; color: var(--text); margin-bottom:2px; }
    .settings-value{ font-size:12px; color: var(--muted); font-weight:800; }

    /* ===== Modal ===== */
    .modal-backdrop{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.35);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
      padding: 24px;
    }
    body.dark-mode .modal-backdrop{ background: rgba(0,0,0,.55); }

    .modal{
      width: 520px;
      max-width: 100%;
      background: color-mix(in oklab, var(--surface) 96%, transparent);
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 18px;
      box-shadow: 0 30px 80px rgba(0,0,0,.18);
      backdrop-filter: blur(10px);
    }

    .modal-head{
      display:flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .modal-title{
      font-size: 15px;
      font-weight: 900;
      letter-spacing: -.2px;
      color: var(--text);
    }

    .modal-close{
      width: 34px; height: 34px;
      border-radius: 10px;
      border: 1px solid var(--line);
      background: var(--surface);
      cursor: pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      color: var(--muted);
      transition:0.18s ease;
    }
    .modal-close:hover{
      color: var(--text);
      border-color: color-mix(in oklab, var(--text) 18%, var(--line));
      transform: translateY(-1px);
    }
    .modal-close:focus-visible{ outline:none; box-shadow: var(--focus); }

    .form-row{ display:flex; gap: 12px; margin-top: 12px; flex-wrap: wrap; }
    .form-col{ flex:1; min-width: 210px; }

    label{
      display:block;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
      font-weight: 900;
      letter-spacing: .2px;
    }

    input[type="text"], input[type="email"]{
      width: 100%;
      height: 42px;
      border-radius: 12px;
      border: 1px solid var(--line);
      padding: 0 12px;
      font-size: 14px;
      outline: none;
      background: var(--surface);
      color: var(--text);
      font-weight: 800;
    }
    input[type="text"]:focus, input[type="email"]:focus{
      box-shadow: var(--focus);
      border-color: color-mix(in oklab, var(--text) 18%, var(--line));
    }

    input[type="file"]{
      width:100%;
      border-radius: 12px;
      border: 1px dashed color-mix(in oklab, var(--text) 18%, var(--line));
      padding: 12px;
      background: var(--surface-2);
      color: var(--text);
      cursor:pointer;
      font-weight: 800;
    }

    .modal-actions{
      display:flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 14px;
    }

    .btn{
      height: 40px;
      padding: 0 14px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: var(--surface);
      font-weight: 900;
      font-size: 13px;
      cursor:pointer;
      color: var(--text);
      transition:0.18s ease;
    }
    .btn:hover{
      border-color: color-mix(in oklab, var(--text) 18%, var(--line));
      transform: translateY(-1px);
    }
    .btn:focus-visible{ outline:none; box-shadow: var(--focus); }

    .btn-primary{
      background: var(--text);
      border-color: var(--text);
      color: var(--bg);
    }
    body.dark-mode .btn-primary{
      background: var(--text);
      border-color: var(--text);
      color: var(--bg);
    }

    /* ===== Responsive ===== */
    @media (max-width:1200px){
      .profile-stats{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }

    @media (max-width:900px){
      :root{ --nav-width: 0px; }

      .nav-panel{
        position:fixed;
        bottom:0;
        top:auto;
        width:100%;
        height:70px;
        border-right:none;
        border-top:1px solid var(--line);
        flex-direction:row;
        justify-content:center;
        padding-bottom: env(safe-area-inset-bottom);
        box-shadow: 0 -12px 28px rgba(0,0,0,0.14);
      }
      .nav-logo{ display:none; }
      .nav-menu{
        flex-direction:row;
        width:100%;
        justify-content:space-around;
        padding:6px 8px;
      }
      .nav-item{
        width:auto;
        min-width:54px;
        padding:8px;
      }
      .nav-item.active::after{ display:none; }
      .nav-label{ font-size:10px; }

      .main-content{
        margin-left:0;
        width:100%;
        padding-bottom: calc(80px + env(safe-area-inset-bottom));
      }

      .top-bar{ padding:0 14px; }
      .content-area{ padding:14px; }

      .profile-header{ padding:14px; gap:14px; }
      .profile-avatar-large{ width:70px; height:70px; }
    }

    @media (max-width:520px){
      .section-header h2{ font-size:22px; }
      .profile-name-row{ flex-direction:column; align-items:flex-start; }
      .edit-profile-btn{ width:100%; }
      .profile-stats{ grid-template-columns: 1fr; }
      .form-col{ min-width: 100%; }
    }
  </style>
</head>

<body>
  <div class="dashboard-container">
    <nav class="nav-panel">
      <div class="nav-logo">FYNX</div>

      <div class="nav-menu">
        <a class="nav-item" href="home.html" data-view="home">
          <svg class="nav-icon" viewBox="0 0 24 24">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
          </svg>
          <span class="nav-label">Home</span>
        </a>

        <a class="nav-item" href="journal.html" data-view="journal">
          <svg class="nav-icon" viewBox="0 0 24 24">
            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
          </svg>
          <span class="nav-label">Journal</span>
        </a>

        <a class="nav-item" href="calculator.html" data-view="calculator">
          <svg class="nav-icon" viewBox="0 0 24 24">
            <rect x="4" y="2" width="16" height="20" rx="2"></rect>
            <line x1="8" y1="6" x2="16" y2="6"></line>
            <line x1="8" y1="10" x2="16" y2="10"></line>
            <line x1="8" y1="14" x2="16" y2="14"></line>
            <line x1="8" y1="18" x2="16" y2="18"></line>
          </svg>
          <span class="nav-label">Calculator</span>
        </a>

        <a class="nav-item" href="news.html" data-view="news">
          <svg class="nav-icon" viewBox="0 0 24 24">
            <path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-2 2zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2"></path>
            <line x1="12" y1="11" x2="18" y2="11"></line>
            <line x1="12" y1="7" x2="18" y2="7"></line>
          </svg>
          <span class="nav-label">News</span>
        </a>

        <a class="nav-item" href="calendar.html" data-view="calendar">
          <svg class="nav-icon" viewBox="0 0 24 24">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          <span class="nav-label">Calendar</span>
        </a>

        <a class="nav-item active" href="profile.html" data-view="profile">
          <svg class="nav-icon" viewBox="0 0 24 24">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
          <span class="nav-label">Profile</span>
        </a>
      </div>
    </nav>

    <main class="main-content">
      <div class="top-bar">
        <h1 class="page-title">Profile</h1>

        <div class="top-bar-right">
          <button class="icon-btn" id="themeBtn" title="Toggle theme" aria-label="Toggle theme">
            <svg viewBox="0 0 24 24">
              <path d="M12 3v2M12 19v2M4.9 4.9l1.4 1.4M17.7 17.7l1.4 1.4M3 12h2M19 12h2M4.9 19.1l1.4-1.4M17.7 6.3l1.4-1.4"></path>
              <circle cx="12" cy="12" r="4"></circle>
            </svg>
          </button>

          <button class="icon-btn" title="Notifications" aria-label="Notifications">
            <svg viewBox="0 0 24 24">
              <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
              <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
            </svg>
          </button>

          <div class="user-avatar" id="topAvatar">FX</div>
        </div>
      </div>

      <div class="content-area">
        <div class="section-header">
          <h2>Profile</h2>
          <p>Manage your account and settings</p>
        </div>

        <section class="panel">
          <div class="profile-header">
            <div class="profile-avatar-large" id="profileAvatarLarge">FX</div>

            <div class="profile-info">
              <div class="profile-name-row">
                <h2 id="profileName">FYNX User</h2>
                <button class="edit-profile-btn" id="editProfileBtn">Edit Profile</button>
              </div>

              <div class="profile-email" id="profileEmail">fynx.user@example.com</div>

              <div class="profile-stats">
                <div class="profile-stat-item">
                  <h4>TOTAL TRADES</h4>
                  <p id="statTotalTrades">—</p>
                </div>
                <div class="profile-stat-item">
                  <h4>WIN RATE</h4>
                  <p id="statWinRate">—</p>
                </div>
                <div class="profile-stat-item">
                  <h4>AVG. RETURN</h4>
                  <p id="statAvgReturn">—</p>
                </div>
                <div class="profile-stat-item">
                  <h4>MEMBER SINCE</h4>
                  <p id="statMemberSince">—</p>
                </div>
              </div>
            </div>
          </div>

          <div class="hint">
            Stats load from your real data if you store it in <b>localStorage</b>:
            <br>- <b>fynx_trades</b> (array of trades)
            <br>- or <b>fynx_metrics</b> (precomputed stats)
          </div>
        </section>

        <div class="settings-section-title">Settings</div>

        <div class="settings-list">
          <div class="settings-item" data-link="account-settings.html">
            <svg class="settings-icon" viewBox="0 0 24 24">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <div class="settings-text">
              <div class="settings-label">Account Settings</div>
              <div class="settings-value">Update your personal information</div>
            </div>
          </div>

          <div class="settings-item" data-link="security.html">
            <svg class="settings-icon" viewBox="0 0 24 24">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
              <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
            </svg>
            <div class="settings-text">
              <div class="settings-label">Security</div>
              <div class="settings-value">Manage password and 2FA</div>
            </div>
          </div>

          <div class="settings-item" data-link="notifications.html">
            <svg class="settings-icon" viewBox="0 0 24 24">
              <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
              <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
            </svg>
            <div class="settings-text">
              <div class="settings-label">Notifications</div>
              <div class="settings-value">Configure alert preferences</div>
            </div>
          </div>

          <div class="settings-item" data-link="preferences.html">
            <svg class="settings-icon" viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="3"></circle>
              <path d="M12 1v6m0 6v6m5.66-13.66l-4.24 4.24m0 6.84l-4.24 4.24m13.66-5.66h-6m-6 0H1m13.66 5.66l-4.24-4.24m0-6.84l-4.24-4.24"></path>
            </svg>
            <div class="settings-text">
              <div class="settings-label">Preferences</div>
              <div class="settings-value">Customize your experience</div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Edit Profile Modal -->
  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal">
      <div class="modal-head">
        <div class="modal-title">Edit Profile</div>
        <button class="modal-close" id="modalClose" aria-label="Close">
          <svg width="16" height="16" viewBox="0 0 24 24" style="stroke:currentColor; fill:none; stroke-width:2;">
            <path d="M18 6L6 18"></path>
            <path d="M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <div class="form-row">
        <div class="form-col">
          <label for="nameInput">Name</label>
          <input type="text" id="nameInput" placeholder="Your name" />
        </div>
        <div class="form-col">
          <label for="emailInput">Email (demo)</label>
          <input type="email" id="emailInput" placeholder="you@example.com" />
        </div>
      </div>

      <div class="form-row">
        <div class="form-col">
          <label for="avatarInput">Profile Image</label>
          <input type="file" id="avatarInput" accept="image/*" />
          <div class="hint" style="margin:10px 0 0; padding:10px;">
            Upload a PNG/JPG. It saves to localStorage (demo product mode).
          </div>
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn" id="cancelBtn">Cancel</button>
        <button class="btn btn-primary" id="saveBtn">Save</button>
      </div>
    </div>
  </div>

  <script>
    /* =========================
       GLOBAL THEME (SYNCED)
       - theme button ONLY here on profile
    ========================= */
    const THEME_KEY = "fynx_theme";
    const themeBtn = document.getElementById("themeBtn");

    function applySavedTheme(){
      const saved = localStorage.getItem(THEME_KEY) || "light";
      document.body.classList.toggle("dark-mode", saved === "dark");
    }
    applySavedTheme();

    themeBtn.addEventListener("click", () => {
      const isDarkNow = !document.body.classList.contains("dark-mode");
      document.body.classList.toggle("dark-mode", isDarkNow);
      localStorage.setItem(THEME_KEY, isDarkNow ? "dark" : "light");
    });

    // ---------- Profile + Stats (Real mode via localStorage) ----------
    const DEFAULT_PROFILE = {
      name: "FYNX User",
      email: "fynx.user@example.com",
      avatarDataUrl: "",
      memberSince: "Jan 2024"
    };

    function safeJSONParse(v, fallback){
      try { return JSON.parse(v); } catch(e){ return fallback; }
    }

    function getProfile(){
      const p = safeJSONParse(localStorage.getItem("fynx_profile"), null);
      return { ...DEFAULT_PROFILE, ...(p || {}) };
    }

    function setProfile(profile){
      localStorage.setItem("fynx_profile", JSON.stringify(profile));
    }

    function initialsFromName(name){
      const parts = String(name || "").trim().split(/\s+/).filter(Boolean);
      const a = (parts[0] || "F").slice(0,1);
      const b = (parts[1] || parts[0] || "X").slice(0,1);
      return (a + b).toUpperCase();
    }

    function renderAvatar(el, profile){
      el.innerHTML = "";
      if (profile.avatarDataUrl){
        const img = document.createElement("img");
        img.src = profile.avatarDataUrl;
        img.alt = "Avatar";
        el.appendChild(img);
      } else {
        el.textContent = initialsFromName(profile.name);
      }
    }

    function loadMetrics(){
      const metrics = safeJSONParse(localStorage.getItem("fynx_metrics"), null);
      if (metrics && typeof metrics === "object") return metrics;

      const trades = safeJSONParse(localStorage.getItem("fynx_trades"), []);
      const total = Array.isArray(trades) ? trades.length : 0;

      let wins = 0;
      let sumReturn = 0;
      let returnCount = 0;

      if (Array.isArray(trades)){
        trades.forEach(t => {
          const pnl = Number(t?.pnl);
          const isWin = (String(t?.result || "").toLowerCase() === "win") || (!Number.isNaN(pnl) && pnl > 0);
          if (isWin) wins++;

          const rp = Number(t?.returnPct ?? t?.pnlPct ?? t?.return);
          if (!Number.isNaN(rp)){
            sumReturn += rp;
            returnCount++;
          }
        });
      }

      const winRate = total ? (wins / total) * 100 : null;
      const avgReturn = returnCount ? (sumReturn / returnCount) : null;

      let memberSince = null;
      const dates = (Array.isArray(trades) ? trades : [])
        .map(t => new Date(t?.date || t?.createdAt || t?.timestamp || ""))
        .filter(d => !isNaN(d.getTime()))
        .sort((a,b)=>a-b);

      if (dates.length){
        const d = dates[0];
        memberSince = d.toLocaleString(undefined, { month: "short", year: "numeric" });
      }

      return { total, winRate, avgReturn, memberSince };
    }

    function fmtNumber(n){
      const x = Number(n);
      if (Number.isNaN(x)) return "—";
      return x.toLocaleString();
    }

    function fmtPercent(n, decimals=1){
      const x = Number(n);
      if (Number.isNaN(x)) return "—";
      return x.toFixed(decimals) + "%";
    }

    function fmtReturn(n){
      const x = Number(n);
      if (Number.isNaN(x)) return "—";
      const sign = x > 0 ? "+" : "";
      return sign + x.toFixed(1) + "%";
    }

    function renderProfile(){
      const profile = getProfile();
      document.getElementById("profileName").textContent = profile.name || DEFAULT_PROFILE.name;
      document.getElementById("profileEmail").textContent = profile.email || DEFAULT_PROFILE.email;

      renderAvatar(document.getElementById("profileAvatarLarge"), profile);
      renderAvatar(document.getElementById("topAvatar"), profile);

      const m = loadMetrics();

      document.getElementById("statTotalTrades").textContent =
        (m.total !== undefined && m.total !== null) ? fmtNumber(m.total) : "—";

      document.getElementById("statWinRate").textContent =
        (m.winRate !== undefined && m.winRate !== null) ? fmtPercent(m.winRate, 1) : "—";

      document.getElementById("statAvgReturn").textContent =
        (m.avgReturn !== undefined && m.avgReturn !== null) ? fmtReturn(m.avgReturn) : "—";

      document.getElementById("statMemberSince").textContent =
        (m.memberSince || profile.memberSince || DEFAULT_PROFILE.memberSince);
    }

    renderProfile();

    // ---------- Settings links ----------
    document.querySelectorAll(".settings-item").forEach(item => {
      item.addEventListener("click", () => {
        const link = item.getAttribute("data-link");
        if (link) window.location.href = link;
      });
    });

    // ---------- Edit profile modal ----------
    const modalBackdrop = document.getElementById("modalBackdrop");
    const editBtn = document.getElementById("editProfileBtn");
    const closeBtn = document.getElementById("modalClose");
    const cancelBtn = document.getElementById("cancelBtn");
    const saveBtn = document.getElementById("saveBtn");

    const nameInput = document.getElementById("nameInput");
    const emailInput = document.getElementById("emailInput");
    const avatarInput = document.getElementById("avatarInput");

    let pendingAvatarDataUrl = "";

    function openModal(){
      const p = getProfile();
      nameInput.value = p.name || "";
      emailInput.value = p.email || "";
      pendingAvatarDataUrl = p.avatarDataUrl || "";
      avatarInput.value = "";
      modalBackdrop.style.display = "flex";
    }

    function closeModal(){
      modalBackdrop.style.display = "none";
    }

    editBtn.addEventListener("click", openModal);
    closeBtn.addEventListener("click", closeModal);
    cancelBtn.addEventListener("click", closeModal);

    modalBackdrop.addEventListener("click", (e) => {
      if (e.target === modalBackdrop) closeModal();
    });

    avatarInput.addEventListener("change", (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = () => {
        pendingAvatarDataUrl = String(reader.result || "");
      };
      reader.readAsDataURL(file);
    });

    saveBtn.addEventListener("click", () => {
      const p = getProfile();
      const next = {
        ...p,
        name: (nameInput.value || "").trim() || DEFAULT_PROFILE.name,
        email: (emailInput.value || "").trim() || DEFAULT_PROFILE.email,
        avatarDataUrl: pendingAvatarDataUrl || p.avatarDataUrl || ""
      };

      setProfile(next);
      renderProfile();
      closeModal();
    });
  </script>
</body>
</html>

